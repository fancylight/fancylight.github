<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>elf | 博客</title><meta name="description" content="elf"><meta name="keywords" content="原理"><meta name="author" content="fancylight"><meta name="copyright" content="fancylight"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="elf"><meta name="twitter:description" content="elf"><meta name="twitter:image" content="http://yoursite.com/img/post.jpg"><meta property="og:type" content="article"><meta property="og:title" content="elf"><meta property="og:url" content="http://yoursite.com/2018/09/04/elf/"><meta property="og:site_name" content="博客"><meta property="og:description" content="elf"><meta property="og:image" content="http://yoursite.com/img/post.jpg"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      now = new Date();
      hour = now.getHours();
      isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://yoursite.com/2018/09/04/elf/"><link rel="prev" title="汇编相关要点" href="http://yoursite.com/2018/09/05/%E6%B1%87%E7%BC%96%E7%9B%B8%E5%85%B3%E8%A6%81%E7%82%B9/"><link rel="next" title="c++ google style.md" href="http://yoursite.com/2018/09/03/c++%20google%20style/"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5/js/md5.min.js"></script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: false,
  highlightShrink: false,
  isFontAwesomeV5: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false
}</script><meta name="generator" content="Hexo 4.2.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">36</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">18</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">4</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> List</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#"><span class="toc-number">1.</span> <span class="toc-text">elf文件(Executable and Linkable Format)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#文件分类"><span class="toc-number">1.0.1.</span> <span class="toc-text">文件分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#文件格式"><span class="toc-number">1.0.2.</span> <span class="toc-text">文件格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#efl头-elf-header"><span class="toc-number">1.0.3.</span> <span class="toc-text">efl头 elf header</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#程序头表-progrom-header"><span class="toc-number">1.0.4.</span> <span class="toc-text">程序头表 progrom header</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#节头表-section-header-table"><span class="toc-number">1.0.5.</span> <span class="toc-text">节头表 section header table</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#符号表条目-symble-table-entry"><span class="toc-number">1.0.6.</span> <span class="toc-text">符号表条目 symble table entry</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#可重定位符号条目-Relocation-table-entry"><span class="toc-number">1.0.7.</span> <span class="toc-text">可重定位符号条目 Relocation table entry</span></a></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(/img/post.jpg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">博客</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> List</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div></span></div><div id="post-info"><div id="post-title"><div class="posttitle">elf</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2018-09-04<span class="post-meta__separator">|</span><i class="fa fa-history" aria-hidden="true"></i> 更新于 2019-05-09</time><span class="post-meta__separator">|</span><span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/C/">C</a></span><div class="post-meta-wordcount"><div class="post-meta-pv-cv"><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-comment-o" aria-hidden="true"></i><span>评论数:</span><a href="/2018/09/04/elf/#post-comment"><span class="gitalk-comment-count comment-count"></span></a></div></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div id="article-container"><h1>elf文件(Executable and Linkable Format)</h1>
<p><a href="http://www.skyfree.org/linux/references/ELF_Format.pdf" target="_blank" rel="noopener">文档参考</a></p>
<hr>
<h3 id="文件分类"><a class="header-anchor" href="#文件分类">¶</a>文件分类</h3>
<ul>
<li>可重定位文件:由编译器产生,具有重定位信息,没有程序头</li>
<li>可执行文件:由链接器产生</li>
</ul>
<img src="/2018/09/04/elf/1.png" class="">
<p>上图说明了，一个目标文件生成可执行文件，然后加载到内存后的映射等，三个步骤。<br>
ELF头描述了生成该文件的系统的字的大小和字节序。ELF和节头部表之间每个部分都称为一个节（section）<br>
.text：已编译程序的机器代码<br>
.rodada：只读数据，比如printf语句中的格式串。<br>
.data：已经初始化的全局C变量。局部变量在运行时保存在栈中。即不再data节也不在bss节<br>
.bss：未初始化的全局C变量。不占据实际的空间，仅仅是一个占位符。所以未初始化变量不需要占据任何实际的磁盘空间。C++弱化BSS段。可能是没有，也可能有。<br>
.symtab：一个符号表，它存放“在程序中定义和引用的函数和全局变量的信息”。<br>
.rel.text：一个.text节中位置的列表。（将来重定位使用的）<br>
.rel.data：被模块引用或定义的任何全局变量的重定位信息。<br>
.debug：调试符号表，其内容是程序中定义的局部变量和类型定义。<br>
.line：原始C源程序的行号和.text节中机器指令之间的映射。<br>
.strtab：一个字符串表.</p>
<p>程序头表通过段的形式将可执行文件分类，其描述了不同段具有的性质，比如说load，说明这部分内容是载入程序的，PT_GNU_RELRO，表示被定义为该段的内容在重定向后不能再被读取<br>
section table 则通过将文件本身的信息描述在不同的section中，如 text table表示了汇编代码。。</p>
<hr>
<h3 id="文件格式"><a class="header-anchor" href="#文件格式">¶</a>文件格式</h3>
<blockquote><p>通过直接查看linux  <code>usr/include/elf.h</code>文件可以明确了解</p>
</blockquote>
<img src="/2018/09/04/elf/elf%E6%A0%BC%E5%BC%8F.png" class="" title="elf两种典型格式">
<ul>
<li>elf.h头文件</li>
</ul>
<table>
<thead>
<tr>
<th>名称</th>
<th>大小</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td>Elf32_Half</td>
<td>2</td>
<td>无符号整数</td>
</tr>
<tr>
<td>Elf64_Half</td>
<td>2</td>
<td>无符号整数</td>
</tr>
<tr>
<td>Elf32_Word</td>
<td>4</td>
<td>无符号整数</td>
</tr>
<tr>
<td>Elf32_Sword</td>
<td>4</td>
<td>带符号整数</td>
</tr>
<tr>
<td>Elf64_Word</td>
<td>4</td>
<td>无符号整数</td>
</tr>
<tr>
<td>Elf64_Sword</td>
<td>4</td>
<td>带符号整数</td>
</tr>
<tr>
<td>Elf32_Xword</td>
<td>8</td>
<td>无符号整数</td>
</tr>
<tr>
<td>Elf32_Sxword</td>
<td>8</td>
<td>带符号整数</td>
</tr>
<tr>
<td>Elf64_Xword</td>
<td>8</td>
<td>带符号整数</td>
</tr>
<tr>
<td>Elf64_Sxword</td>
<td>8</td>
<td>无符号整数</td>
</tr>
<tr>
<td>Elf32_Addr</td>
<td>4</td>
<td>地址</td>
</tr>
<tr>
<td>Elf64_Addr</td>
<td>8</td>
<td>地址</td>
</tr>
<tr>
<td>Elf32_Off</td>
<td>4</td>
<td>偏移</td>
</tr>
<tr>
<td>Elf64_Off</td>
<td>8</td>
<td>偏移</td>
</tr>
<tr>
<td>Elf32_Section</td>
<td>2</td>
<td>节</td>
</tr>
<tr>
<td>Elf64_Section</td>
<td>2</td>
<td>节</td>
</tr>
<tr>
<td>Elf32_Versym</td>
<td>2</td>
<td>符号信息</td>
</tr>
<tr>
<td>Elf64_Versym</td>
<td>2</td>
<td>符号信息</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="efl头-elf-header"><a class="header-anchor" href="#efl头-elf-header">¶</a>efl头 elf header</h3>
<ul>
<li>elf头:32位和64位分别占52和60字节</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">typedef struct</span><br><span class="line">&#123;</span><br><span class="line">    unsigned char	e_ident[EI_NIDENT];	&#x2F;* 魔数 *&#x2F;</span><br><span class="line">    Elf32_Half	e_type;			&#x2F;* 文件类型:可执行&#x2F;可重入 *&#x2F;</span><br><span class="line">    Elf32_Half	e_machine;		&#x2F;* 机器 *&#x2F;</span><br><span class="line">    Elf32_Word	e_version;		&#x2F;* 文件版本</span><br><span class="line">    Elf32_Addr	e_entry;		&#x2F;* 入口点地址*&#x2F;</span><br><span class="line">    Elf32_Off	e_phoff;		&#x2F;* 程序头距离文件起始偏移量*&#x2F;</span><br><span class="line">    Elf32_Off	e_shoff;		&#x2F;* 节头表距离文件起始偏移量 *&#x2F;</span><br><span class="line">    Elf32_Word	e_flags;		&#x2F;* 处理器标志 *&#x2F;</span><br><span class="line">    Elf32_Half	e_ehsize;		&#x2F;*elf头大小 *&#x2F;</span><br><span class="line">    Elf32_Half	e_phentsize;		&#x2F;* 程序头中各条目大小 *&#x2F;</span><br><span class="line">    Elf32_Half	e_phnum;		&#x2F;* 程序头中条目数量 *&#x2F;</span><br><span class="line">    Elf32_Half	e_shentsize;		&#x2F;* 节头表中条目大小 *&#x2F;</span><br><span class="line">    Elf32_Half	e_shnum;		&#x2F;* 节头表中条目数量 *&#x2F;</span><br><span class="line">    Elf32_Half	e_shstrndx;		&#x2F;* 接头表在符号表中的下标 *&#x2F;</span><br><span class="line">&#125; Elf32_Ehdr;</span><br><span class="line"></span><br><span class="line">typedef struct</span><br><span class="line">&#123;</span><br><span class="line">    unsigned char	e_ident[EI_NIDENT];	&#x2F;* Magic number and other info *&#x2F;</span><br><span class="line">    Elf64_Half	e_type;			&#x2F;* Object file type *&#x2F;</span><br><span class="line">    Elf64_Half	e_machine;		&#x2F;* Architecture *&#x2F;</span><br><span class="line">    Elf64_Word	e_version;		&#x2F;* Object file version *&#x2F;</span><br><span class="line">    Elf64_Addr	e_entry;		&#x2F;* Entry point virtual address *&#x2F;</span><br><span class="line">    Elf64_Off	e_phoff;		&#x2F;* Program header table file offset *&#x2F;</span><br><span class="line">    Elf64_Off	e_shoff;		&#x2F;* Section header table file offset *&#x2F;</span><br><span class="line">    Elf64_Word	e_flags;		&#x2F;* Processor-specific flags *&#x2F;</span><br><span class="line">    Elf64_Half	e_ehsize;		&#x2F;* ELF header size in bytes *&#x2F;</span><br><span class="line">    Elf64_Half	e_phentsize;		&#x2F;* Program header table entry size *&#x2F;</span><br><span class="line">    Elf64_Half	e_phnum;		&#x2F;* Program header table entry count *&#x2F;</span><br><span class="line">    Elf64_Half	e_shentsize;		&#x2F;* Section header table entry size *&#x2F;</span><br><span class="line">    Elf64_Half	e_shnum;		&#x2F;* Section header table entry count *&#x2F;</span><br><span class="line">    Elf64_Half	e_shstrndx;		&#x2F;* Section header string table index *&#x2F;</span><br><span class="line">&#125; Elf64_Ehdr;</span><br></pre></td></tr></table></figure>
<ul>
<li>使用linux readelf命令可以读取elf文件,参考<a href="http://man.linuxde.net/readelf" target="_blank" rel="noopener">elf命令</a></li>
<li>使用hexdump -x obj -n xx 按照16进制双字节排列 读取obj前xx字节数据</li>
<li>-x表示双排列 - n表示读取多少  -s 表示偏移</li>
</ul>
<figure class="highlight cpp"><figcaption><span>test.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sum</span><span class="params">(<span class="keyword">int</span> *a,<span class="keyword">int</span> n)</span></span>;</span><br><span class="line"><span class="keyword">int</span> <span class="built_in">array</span>[<span class="number">2</span>]=&#123;<span class="number">1</span>,<span class="number">2</span>&#125;;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> val=sum(<span class="built_in">array</span>,<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">return</span> val;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>sum.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sum</span><span class="params">(<span class="keyword">int</span> *a,<span class="keyword">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i,s=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;n;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        s+a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@riMlzL162793 link]# readelf -h test</span><br><span class="line">ELF Header:</span><br><span class="line">  Magic:   7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00 </span><br><span class="line">  Class:                             ELF64</span><br><span class="line">  Data:                              2&#39;s complement, little endian</span><br><span class="line">  Version:                           1 (current)</span><br><span class="line">  OS&#x2F;ABI:                            UNIX - System V</span><br><span class="line">  ABI Version:                       0</span><br><span class="line">  Type:                              EXEC (Executable file)</span><br><span class="line">  Machine:                           Advanced Micro Devices X86-64</span><br><span class="line">  Version:                           0x1</span><br><span class="line">  Entry point address:               0x4004c0</span><br><span class="line">  Start of program headers:          64 (bytes into file)</span><br><span class="line">  Start of section headers:          6648 (bytes into file)</span><br><span class="line">  Flags:                             0x0</span><br><span class="line">  Size of this header:               64 (bytes)</span><br><span class="line">  Size of program headers:           56 (bytes)</span><br><span class="line">  Number of program headers:         9</span><br><span class="line">  Size of section headers:           64 (bytes)</span><br><span class="line">  Number of section headers:         30</span><br><span class="line">  Section header string table index: 27</span><br><span class="line">[root@riMlzL162793 link]# hexdump -x test -n 64</span><br><span class="line">#此处每两个字节是按照高低位放置的</span><br><span class="line">0000000    457f    464c    0102    0001    0000    0000    0000    0000 </span><br><span class="line">0000010    0002    003e    0001    0000    04c0    0040    0000    0000 </span><br><span class="line">0000020    0040    0000    0000    0000    19f8    0000    0000    0000</span><br><span class="line">0000030    0000    0000    0040    0038    0009    0040    001e    001b</span><br><span class="line">0000040</span><br></pre></td></tr></table></figure>
<ul>
<li>第一行:7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00 ,前四个字节7f454c46(0x45,0x4c,0x46是’e’,‘l’,'f’对应的ascii编码）是一个魔数，表示这是一个ELF对象。02 表示elf64 01 表示小端补码,01,其他都为0</li>
<li>第二行:0002 表示为可执行文件,003e表示机器Advanced Micro Devices X86-64,0000 0001表示版本1,0000 0000 0040 04c0 表示 入口地址</li>
<li>第三行:0000 0000 0000 0040 表示progrom header table距离文件偏移(64), 0000 0000 0000 19f8表示section header table偏移(6648)</li>
<li>第四行:0000 0000 表示处理器标志,0040表示elf header大小(64),0038表示程序头表大小(56),0009表示progrom header entry数量(9) ,0040表示section header 大小 (64),001e section header entry(30),section header 字符串(string table)下标27</li>
</ul>
<hr>
<h3 id="程序头表-progrom-header"><a class="header-anchor" href="#程序头表-progrom-header">¶</a>程序头表 progrom header</h3>
<p>程序头表将可执行文件按照段进行分类</p>
<p>可执行文件或者共享目标文件的程序头部是一个结构数组，每个结构描述了一个段 或者系统准备程序执行所必需的其它信息。目标文件的“段”包含一个或者多个“节区”， 也就是“段内容(Segment Contents)”。程序头部仅对于可执行文件和共享目标文件 有意义。 可执行目标文件在 ELF 头部的 e_phentsize和e_phnum 成员中给出其自身程序头部 的大小。程序头部的数据结构:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    Elf32_Word	p_type;			<span class="comment">/* Segment type */</span></span><br><span class="line">    Elf32_Off	p_offset;		<span class="comment">/* Segment file offset */</span></span><br><span class="line">    Elf32_Addr	p_vaddr;		<span class="comment">/* Segment virtual address */</span></span><br><span class="line">    Elf32_Addr	p_paddr;		<span class="comment">/* Segment physical address */</span></span><br><span class="line">    Elf32_Word	p_filesz;		<span class="comment">/* Segment size in file */</span></span><br><span class="line">    Elf32_Word	p_memsz;		<span class="comment">/* Segment size in memory */</span></span><br><span class="line">    Elf32_Word	p_flags;		<span class="comment">/* Segment flags */</span></span><br><span class="line">    Elf32_Word	p_align;		<span class="comment">/* Segment alignment */</span></span><br><span class="line">&#125; Elf32_Phdr;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    Elf64_Word	p_type;			<span class="comment">/* Segment type */</span></span><br><span class="line">    Elf64_Word	p_flags;		<span class="comment">/* Segment flags */</span></span><br><span class="line">    Elf64_Off	p_offset;		<span class="comment">/* Segment file offset */</span></span><br><span class="line">    Elf64_Addr	p_vaddr;		<span class="comment">/* Segment virtual address */</span></span><br><span class="line">    Elf64_Addr	p_paddr;		<span class="comment">/* Segment physical address */</span></span><br><span class="line">    Elf64_Xword	p_filesz;		<span class="comment">/* Segment size in file */</span></span><br><span class="line">    Elf64_Xword	p_memsz;		<span class="comment">/* Segment size in memory */</span></span><br><span class="line">    Elf64_Xword	p_align;		<span class="comment">/* Segment alignment */</span></span><br><span class="line">&#125; Elf64_Phdr;</span><br></pre></td></tr></table></figure>
<ul>
<li>type 此数组元素描述的段的类型，或者如何解释此数组元素的信息。具体如.</li>
<li>offset 此成员给出从文件头到该段第一个字节的偏移。</li>
<li>vaddr 此成员给出段的第一个字节将被放到内存中的虚拟地址。</li>
<li>paddr 此成员仅用于与物理地址相关的系统中。</li>
<li>filesz 此成员给出段在文件映像中所占的字节数。可以为 0。</li>
<li>memsz 此成员给出段在内存映像中占用的字节数。可以为 0。</li>
<li>flags 此成员给出与段相关的标志。</li>
<li>align 可加载的进程段的 p_vaddr 和 p_offset 取值必须合适，相对于对页面大小的取模而言。此成员给出在文件中和内存中如何 对齐。数值 0 和 1 表示不需要对齐。否则 p_align 应该是个正整数，并且是 2 的幂次数，p_vaddr 和 p_offset 对 p_align 取模后应该相等。</li>
</ul>
<figure class="highlight plain"><figcaption><span>程序头宏定义</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;* Legal values for p_type (segment type).  *&#x2F;</span><br><span class="line">#define	PT_NULL		0		&#x2F;* Program header table entry unused *&#x2F;</span><br><span class="line">#define PT_LOAD		1		&#x2F;* Loadable program segment *&#x2F;</span><br><span class="line">#define PT_DYNAMIC	2		&#x2F;* Dynamic linking information 动态链接信息*&#x2F;</span><br><span class="line">#define PT_INTERP	3		&#x2F;* Program interpreter  程序解释器，linux下该段存放了动态链接器的位置*&#x2F;</span><br><span class="line">#define PT_NOTE		4		&#x2F;* Auxiliary information  辅助信息*&#x2F;</span><br><span class="line">#define PT_SHLIB	5		&#x2F;* Reserved 保留 *&#x2F;</span><br><span class="line">#define PT_PHDR		6		&#x2F;* Entry for header table itself 代表程序头本身*&#x2F;</span><br><span class="line">#define PT_TLS		7		&#x2F;* Thread-local storage segment *&#x2F;</span><br><span class="line">#define	PT_NUM		8		&#x2F;* Number of defined types *&#x2F;</span><br><span class="line">#define PT_LOOS		0x60000000	&#x2F;* Start of OS-specific *&#x2F;</span><br><span class="line">#define PT_GNU_EH_FRAME	0x6474e550	&#x2F;* GCC .eh_frame_hdr segment *&#x2F;</span><br><span class="line">#define PT_GNU_STACK	0x6474e551	&#x2F;* Indicates stack executability *&#x2F;</span><br><span class="line">#define PT_GNU_RELRO	0x6474e552	&#x2F;* Read-only after relocation *&#x2F;</span><br><span class="line">#define PT_LOSUNW	0x6ffffffa</span><br><span class="line">#define PT_SUNWBSS	0x6ffffffa	&#x2F;* Sun Specific segment *&#x2F;</span><br><span class="line">#define PT_SUNWSTACK	0x6ffffffb	&#x2F;* Stack segment *&#x2F;</span><br><span class="line">#define PT_HISUNW	0x6fffffff</span><br><span class="line">#define PT_HIOS		0x6fffffff	&#x2F;* End of OS-specific *&#x2F;</span><br><span class="line">#define PT_LOPROC	0x70000000	&#x2F;* Start of processor-specific *&#x2F;</span><br><span class="line">#define PT_HIPROC	0x7fffffff	&#x2F;* End of processor-specific *&#x2F;</span><br></pre></td></tr></table></figure>
<img src="/2018/09/04/elf/efl_program_header.png" class="">
<p>举例说明:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">Program Headers:</span><br><span class="line">  Type           Offset             VirtAddr           PhysAddr</span><br><span class="line">                 FileSiz            MemSiz              Flags  Align</span><br><span class="line">  PHDR           0x0000000000000040 0x0000000000400040 0x0000000000400040</span><br><span class="line">                 0x00000000000001f8 0x00000000000001f8  R E    8</span><br><span class="line">  INTERP         0x0000000000000238 0x0000000000400238 0x0000000000400238</span><br><span class="line">                 0x000000000000001c 0x000000000000001c  R      1</span><br><span class="line">      [Requesting program interpreter: &#x2F;lib64&#x2F;ld-linux-x86-64.so.2]</span><br><span class="line">  LOAD           0x0000000000000000 0x0000000000400000 0x0000000000400000</span><br><span class="line">                 0x00000000000007e4 0x00000000000007e4  R E    200000</span><br><span class="line">  LOAD           0x0000000000000de0 0x0000000000600de0 0x0000000000600de0</span><br><span class="line">                 0x0000000000000254 0x0000000000000258  RW     200000</span><br><span class="line">  DYNAMIC        0x0000000000000df8 0x0000000000600df8 0x0000000000600df8</span><br><span class="line">                 0x0000000000000200 0x0000000000000200  RW     8</span><br><span class="line">  NOTE           0x0000000000000254 0x0000000000400254 0x0000000000400254</span><br><span class="line">                 0x0000000000000044 0x0000000000000044  R      4</span><br><span class="line">  GNU_EH_FRAME   0x0000000000000690 0x0000000000400690 0x0000000000400690</span><br><span class="line">                 0x000000000000003c 0x000000000000003c  R      4</span><br><span class="line">  GNU_STACK      0x0000000000000000 0x0000000000000000 0x0000000000000000</span><br><span class="line">                 0x0000000000000000 0x0000000000000000  RW     10</span><br><span class="line">  GNU_RELRO      0x0000000000000de0 0x0000000000600de0 0x0000000000600de0</span><br><span class="line">                 0x0000000000000220 0x0000000000000220  R      1</span><br><span class="line"></span><br><span class="line"> Section to Segment mapping:</span><br><span class="line">  Segment Sections...</span><br><span class="line">   00     </span><br><span class="line">   01     .interp </span><br><span class="line">   02     .interp .note.ABI-tag .note.gnu.build-id .gnu.hash .dynsym .dynstr .gnu.version .gnu.version_r .rela.dyn .rela.plt .init .plt .text .fini .rodata .eh_frame_hdr .eh_frame </span><br><span class="line">   03     .init_array .fini_array .jcr .dynamic .got .got.plt .data .bss </span><br><span class="line">   04     .dynamic </span><br><span class="line">   05     .note.ABI-tag .note.gnu.build-id </span><br><span class="line">   06     .eh_frame_hdr </span><br><span class="line">   07     </span><br><span class="line">   08     .init_array .fini_array .jcr .dynamic .got </span><br><span class="line">[root@riMlzL162793 link]# hexdump -x test -n 120</span><br><span class="line">0000000    457f    464c    0102    0001    0000    0000    0000    0000</span><br><span class="line">0000010    0002    003e    0001    0000    04c0    0040    0000    0000</span><br><span class="line">0000020    0040    0000    0000    0000    19f8    0000    0000    0000</span><br><span class="line">0000030    0000    0000    0040    0038    0009    0040    001e    001b</span><br><span class="line">0000040    0006    0000    0005    0000    0040    0000    0000    0000</span><br><span class="line">0000050    0040    0040    0000    0000    0040    0040    0000    0000</span><br><span class="line">0000060    01f8    0000    0000    0000    01f8    0000    0000    0000</span><br><span class="line">0000070    0008    0000    0000    0000                                </span><br><span class="line">0000078</span><br></pre></td></tr></table></figure>
<p>由elf头可知program偏移为64字节处,因此0000040开始为program header，每个条目占用56字节</p>
<ul>
<li>40行: 0000 0006 类型对应PT_PHDR ,0000 0005 表示RE(可读可执行),0000 0000 0000 0040表示偏移地址</li>
<li>50: 0000 0000 0040 0040 表示虚拟地址     0000 0000 0040 0040 表示物理地址</li>
<li>60: 0000 0000 0000 01f8 表示在可执行文件中的空间大小 ,01f8    0000    0000    0000表示实际运行时内存大小</li>
<li>70: 0000 0000 0000 0008 表示 对齐方式按照8字节对齐</li>
</ul>
<h3 id="节头表-section-header-table"><a class="header-anchor" href="#节头表-section-header-table">¶</a>节头表 section header table</h3>
 <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    Elf32_Word	sh_name;		<span class="comment">/* Section name (string tbl index) 节名 */</span></span><br><span class="line">    Elf32_Word	sh_type;		<span class="comment">/* Section type 类型*/</span></span><br><span class="line">    Elf32_Word	sh_flags;		<span class="comment">/* Section flags 标志*/</span></span><br><span class="line">    Elf32_Addr	sh_addr;		<span class="comment">/* Section virtual addr at execution 执行虚拟地址*/</span></span><br><span class="line">    Elf32_Off	sh_offset;		<span class="comment">/* Section file offset 文件偏移*/</span></span><br><span class="line">    Elf32_Word	sh_size;		<span class="comment">/* Section size in bytes 大小*/</span></span><br><span class="line">    Elf32_Word	sh_link;		<span class="comment">/* Link to another section */</span></span><br><span class="line">    Elf32_Word	sh_info;		<span class="comment">/* Additional section information */</span></span><br><span class="line">    Elf32_Word	sh_addralign;		<span class="comment">/* Section alignment 对齐方式*/</span></span><br><span class="line">    Elf32_Word	sh_entsize;		<span class="comment">/* Entry size if section holds table */</span></span><br><span class="line">&#125; Elf32_Shdr;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    Elf64_Word	sh_name;		<span class="comment">/* Section name (string tbl index) */</span></span><br><span class="line">    Elf64ord	sh_type;		<span class="comment">/* Section type */</span></span><br><span class="line">    Elf64_Xword	sh_flags;		<span class="comment">/* Section flags */</span></span><br><span class="line">    Elf64_Addr	sh_addr;		<span class="comment">/* Section virtual addr at execution */</span></span><br><span class="line">    Elf64_Off	sh_offset;		<span class="comment">/* Section file offset */</span></span><br><span class="line">    Elf64_Xword	sh_size;		<span class="comment">/* Section size in bytes */</span></span><br><span class="line">    Elf64_Word	sh_link;		<span class="comment">/* Link to another section */</span></span><br><span class="line">    Elf64_Word	sh_info;		<span class="comment">/* Additional section information */</span></span><br><span class="line">    Elf64_Xword	sh_addralign;		<span class="comment">/* Section alignment */</span></span><br><span class="line">    Elf64_Xword	sh_entsize;		<span class="comment">/* Entry size if section holds table */</span></span><br><span class="line">&#125; Elf64_Shdr;</span><br></pre></td></tr></table></figure>
<p>这个结构体中sh_type 对应了不同种类的section</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"> &#x2F;* Legal values for sh_type (section type).  *&#x2F;</span><br><span class="line"></span><br><span class="line">#define SHT_NULL	  0		&#x2F;* Section header table entry unused *&#x2F;</span><br><span class="line">#define SHT_PROGBITS	  1		&#x2F;* Program data *&#x2F;</span><br><span class="line">#define SHT_SYMTAB	  2		&#x2F;* Symbol table *&#x2F;</span><br><span class="line">#define SHT_STRTAB	  3		&#x2F;* String table *&#x2F;</span><br><span class="line">#define SHT_RELA	  4		&#x2F;* Relocation entries with addends *&#x2F;</span><br><span class="line">#define SHT_HASH	  5		&#x2F;* Symbol hash table *&#x2F;</span><br><span class="line">#define SHT_DYNAMIC	  6		&#x2F;* Dynamic linking information *&#x2F;</span><br><span class="line">#define SHT_NOTE	  7		&#x2F;* Notes *&#x2F;</span><br><span class="line">#define SHT_NOBITS	  8		&#x2F;* Program space with no data (bss) *&#x2F;</span><br><span class="line">#define SHT_REL		  9		&#x2F;* Relocation entries, no addends *&#x2F;</span><br><span class="line">#define SHT_SHLIB	  10		&#x2F;* Reserved *&#x2F;</span><br><span class="line">#define SHT_DYNSYM	  11		&#x2F;* Dynamic linker symbol table *&#x2F;</span><br><span class="line">#define SHT_INIT_ARRAY	  14		&#x2F;* Array of constructors *&#x2F;</span><br><span class="line">#define SHT_FINI_ARRAY	  15		&#x2F;* Array of destructors *&#x2F;</span><br><span class="line">#define SHT_PREINIT_ARRAY 16		&#x2F;* Array of pre-constructors *&#x2F;</span><br><span class="line">#define SHT_GROUP	  17		&#x2F;* Section group *&#x2F;</span><br><span class="line">#define SHT_SYMTAB_SHNDX  18		&#x2F;* Extended section indeces *&#x2F;</span><br><span class="line">#define	SHT_NUM		  19		&#x2F;* Number of defined types.  *&#x2F;</span><br><span class="line">#define SHT_LOOS	  0x60000000	&#x2F;* Start OS-specific.  *&#x2F;</span><br><span class="line">#define SHT_GNU_ATTRIBUTES 0x6ffffff5	&#x2F;* Object attributes.  *&#x2F;</span><br><span class="line">#define SHT_GNU_HASH	  0x6ffffff6	&#x2F;* GNU-style hash table.  *&#x2F;</span><br><span class="line">#define SHT_GNU_LIBLIST	  0x6ffffff7	&#x2F;* Prelink library list *&#x2F;</span><br><span class="line">#define SHT_CHECKSUM	  0x6ffffff8	&#x2F;* Checksum for DSO content.  *&#x2F;</span><br><span class="line">#define SHT_LOSUNW	  0x6ffffffa	&#x2F;* Sun-specific low bound.  *&#x2F;</span><br><span class="line">#define SHT_SUNW_move	  0x6ffffffa</span><br><span class="line">#define SHT_SUNW_COMDAT   0x6ffffffb</span><br><span class="line">#define SHT_SUNW_syminfo  0x6ffffffc</span><br><span class="line">#define SHT_GNU_verdef	  0x6ffffffd	&#x2F;* Version definition section.  *&#x2F;</span><br><span class="line">#define SHT_GNU_verneed	  0x6ffffffe	&#x2F;* Version needs section.  *&#x2F;</span><br><span class="line">#define SHT_GNU_versym	  0x6fffffff	&#x2F;* Version symbol table.  *&#x2F;</span><br><span class="line">#define SHT_HISUNW	  0x6fffffff	&#x2F;* Sun-specific high bound.  *&#x2F;</span><br><span class="line">#define SHT_HIOS	  0x6fffffff	&#x2F;* End OS-specific type *&#x2F;</span><br><span class="line">#define SHT_LOPROC	  0x70000000	&#x2F;* Start of processor-specific *&#x2F;</span><br><span class="line">#define SHT_HIPROC	  0x7fffffff	&#x2F;* End of processor-specific *&#x2F;</span><br><span class="line">#define SHT_LOUSER	  0x80000000	&#x2F;* Start of application-specific *&#x2F;</span><br><span class="line">#define SHT_HIUSER	  0x8fffffff	&#x2F;* End of application-specific *&#x2F;</span><br></pre></td></tr></table></figure>
<p>section table</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">[root@riMlzL162793 link]# readelf -S test</span><br><span class="line">There are 30 section headers, starting at offset 0x19f8:</span><br><span class="line"></span><br><span class="line">Section Headers:</span><br><span class="line">  [Nr] Name              Type             Address           Offset</span><br><span class="line">       Size              EntSize          Flags  Link  Info  Align</span><br><span class="line">  [ 0]                   NULL             0000000000000000  00000000</span><br><span class="line">       0000000000000000  0000000000000000           0     0     0</span><br><span class="line">  [ 1] .interp           PROGBITS         0000000000400238  00000238</span><br><span class="line">       000000000000001c  0000000000000000   A       0     0     1</span><br><span class="line">  [ 2] .note.ABI-tag     NOTE             0000000000400254  00000254</span><br><span class="line">       0000000000000020  0000000000000000   A       0     0     4</span><br><span class="line">  [ 3] .note.gnu.build-i NOTE             0000000000400274  00000274</span><br><span class="line">       0000000000000024  0000000000000000   A       0     0     4</span><br><span class="line">  [ 4] .gnu.hash         GNU_HASH         0000000000400298  00000298</span><br><span class="line">       000000000000001c  0000000000000000   A       5     0     8</span><br><span class="line">  [ 5] .dynsym           DYNSYM           00000000004002b8  000002b8</span><br><span class="line">       0000000000000090  0000000000000018   A       6     1     8</span><br><span class="line">  [ 6] .dynstr           STRTAB           0000000000400348  00000348</span><br><span class="line">       00000000000000a9  0000000000000000   A       0     0     1</span><br><span class="line">  [ 7] .gnu.version      VERSYM           00000000004003f2  000003f2</span><br><span class="line">       000000000000000c  0000000000000002   A       5     0     2</span><br><span class="line">  [ 8] .gnu.version_r    VERNEED          0000000000400400  00000400</span><br><span class="line">       0000000000000020  0000000000000000   A       6     1     8</span><br><span class="line">  [ 9] .rela.dyn         RELA             0000000000400420  00000420</span><br><span class="line">       0000000000000018  0000000000000018   A       5     0     8</span><br><span class="line">  [10] .rela.plt         RELA             0000000000400438  00000438</span><br><span class="line">       0000000000000030  0000000000000018  AI       5    12     8</span><br><span class="line">  [11] .init             PROGBITS         0000000000400468  00000468</span><br><span class="line">       000000000000001a  0000000000000000  AX       0     0     4</span><br><span class="line">  [12] .plt              PROGBITS         0000000000400490  00000490</span><br><span class="line">       0000000000000030  0000000000000010  AX       0     0     16</span><br><span class="line">  [13] .text             PROGBITS         00000000004004c0  000004c0</span><br><span class="line">       00000000000001b2  0000000000000000  AX       0     0     16</span><br><span class="line">  [14] .fini             PROGBITS         0000000000400674  00000674</span><br><span class="line">       0000000000000009  0000000000000000  AX       0     0     4</span><br><span class="line">  [15] .rodata           PROGBITS         0000000000400680  00000680</span><br><span class="line">       0000000000000010  0000000000000000   A       0     0     8</span><br><span class="line">  [16] .eh_frame_hdr     PROGBITS         0000000000400690  00000690</span><br><span class="line">       000000000000003c  0000000000000000   A       0     0     4</span><br><span class="line">  [17] .eh_frame         PROGBITS         00000000004006d0  000006d0</span><br><span class="line">       0000000000000114  0000000000000000   A       0     0     8</span><br><span class="line">  [18] .init_array       INIT_ARRAY       0000000000600de0  00000de0</span><br><span class="line">       0000000000000008  0000000000000000  WA       0     0     8</span><br><span class="line">  [19] .fini_array       FINI_ARRAY       0000000000600de8  00000de8</span><br><span class="line">       0000000000000008  0000000000000000  WA       0     0     8</span><br><span class="line">  [20] .jcr              PROGBITS         0000000000600df0  00000df0</span><br><span class="line">       0000000000000008  0000000000000000  WA       0     0     8</span><br><span class="line">  [21] .dynamic          DYNAMIC          0000000000600df8  00000df8</span><br><span class="line">       0000000000000200  0000000000000010  WA       6     0     8</span><br><span class="line">  [22] .got              PROGBITS         0000000000600ff8  00000ff8</span><br><span class="line">       0000000000000008  0000000000000008  WA       0     0     8</span><br><span class="line">  [23] .got.plt          PROGBITS         0000000000601000  00001000</span><br><span class="line">       0000000000000028  0000000000000008  WA       0     0     8</span><br><span class="line">  [24] .data             PROGBITS         0000000000601028  00001028</span><br><span class="line">       000000000000000c  0000000000000000  WA       0     0     4</span><br><span class="line">  [25] .bss              NOBITS           0000000000601034  00001034</span><br><span class="line">       0000000000000004  0000000000000000  WA       0     0     1</span><br><span class="line">  [26] .comment          PROGBITS         0000000000000000  00001034</span><br><span class="line">       000000000000002d  0000000000000001  MS       0     0     1</span><br><span class="line">  [27] .shstrtab         STRTAB           0000000000000000  00001061</span><br><span class="line">       0000000000000108  0000000000000000           0     0     1</span><br><span class="line">  [28] .symtab           SYMTAB           0000000000000000  00001170</span><br><span class="line">       0000000000000648  0000000000000018          29    46     8</span><br><span class="line">  [29] .strtab           STRTAB           0000000000000000  000017b8</span><br><span class="line">       000000000000023e  0000000000000000</span><br></pre></td></tr></table></figure>
<p>hexdump</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0001a38    001b    0000    0001    0000    0002    0000    0000    0000</span><br><span class="line">0001a48    0238    0040    0000    0000    0238    0000    0000    0000</span><br><span class="line">0001a58    001c    0000    0000    0000    0000    0000    0000    0000</span><br><span class="line">0001a68    0001    0000    0000    0000    0000    0000    0000    0000</span><br></pre></td></tr></table></figure>
<p>正确显示了对应第2个section  interp</p>
<h3 id="符号表条目-symble-table-entry"><a class="header-anchor" href="#符号表条目-symble-table-entry">¶</a>符号表条目 symble table entry</h3>
<p>数据结构</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line">typedef struct</span><br><span class="line">&#123;</span><br><span class="line">  Elf32_Word	st_name;		&#x2F;* Symbol name (string tbl index) *&#x2F;</span><br><span class="line">  Elf32_Addr	st_value;		&#x2F;* Symbol value *&#x2F;</span><br><span class="line">  Elf32_Word	st_size;		&#x2F;* Symbol size *&#x2F;</span><br><span class="line">  unsigned char	st_info;		&#x2F;* Symbol type and binding *&#x2F;</span><br><span class="line">  unsigned char	st_other;		&#x2F;* Symbol visibility *&#x2F;</span><br><span class="line">  Elf32_Section	st_shndx;		&#x2F;* Section index *&#x2F;</span><br><span class="line">&#125; Elf32_Sym;</span><br><span class="line"></span><br><span class="line">typedef struct</span><br><span class="line">&#123;</span><br><span class="line">  Elf64_Word	st_name;		&#x2F;* Symbol name (string tbl index) *&#x2F;</span><br><span class="line">  unsigned char	st_info;		&#x2F;* Symbol type and binding *&#x2F;</span><br><span class="line">  unsigned char st_other;		&#x2F;* Symbol visibility *&#x2F;</span><br><span class="line">  Elf64_Section	st_shndx;		&#x2F;* Section index *&#x2F;</span><br><span class="line">  Elf64_Addr	st_value;		&#x2F;* Symbol value *&#x2F;</span><br><span class="line">  Elf64_Xword	st_size;		&#x2F;* Symbol size *&#x2F;</span><br><span class="line">&#125; Elf64_Sym;</span><br></pre></td></tr></table></figure>
 <img src="/2018/09/04/elf/%E7%AC%A6%E5%8F%B7%E8%A1%A8%E8%A7%A3%E9%87%8A.png" class="">
<ul>
<li>其中st_info st_other都是分为4个bit代表一个信息<br>
linux下：</li>
</ul>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> [root@riMlzL162793 link]# readelf -s test.o</span><br><span class="line"></span><br><span class="line">Symbol table &#39;.symtab&#39; contains 11 entries:</span><br><span class="line">   Num:    Value          Size Type    Bind   Vis      Ndx Name</span><br><span class="line">     0: 0000000000000000     0 NOTYPE  LOCAL  DEFAULT  UND </span><br><span class="line">     1: 0000000000000000     0 FILE    LOCAL  DEFAULT  ABS test.cpp</span><br><span class="line">     2: 0000000000000000     0 SECTION LOCAL  DEFAULT    1 </span><br><span class="line">     3: 0000000000000000     0 SECTION LOCAL  DEFAULT    3 </span><br><span class="line">     4: 0000000000000000     0 SECTION LOCAL  DEFAULT    4 </span><br><span class="line">     5: 0000000000000000     0 SECTION LOCAL  DEFAULT    6 </span><br><span class="line">     6: 0000000000000000     0 SECTION LOCAL  DEFAULT    7 </span><br><span class="line">     7: 0000000000000000     0 SECTION LOCAL  DEFAULT    5 </span><br><span class="line">     8: 0000000000000000     8 OBJECT  GLOBAL DEFAULT    3 array</span><br><span class="line">     9: 0000000000000000    31 FUNC    GLOBAL DEFAULT    1 main</span><br><span class="line">    10: 0000000000000000     0 NOTYPE  GLOBAL DEFAULT  UND _Z3sumPii</span><br></pre></td></tr></table></figure>
<ul>
<li>最后三项分别就是 array全局符号,main 全局符号,UND_Z3sumPii就是sum这个符号,它是未定义的所以type是notype,并且没有在该obj中任意一节中.</li>
</ul>
<h3 id="可重定位符号条目-Relocation-table-entry"><a class="header-anchor" href="#可重定位符号条目-Relocation-table-entry">¶</a>可重定位符号条目 Relocation table entry</h3>
<p>通过表示在符号表中的位置，以及在文件中的偏移量代表重定位信息</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"> &#x2F;* Relocation table entry without addend (in section of type SHT_REL).  *&#x2F;</span><br><span class="line"></span><br><span class="line">typedef struct</span><br><span class="line">&#123;</span><br><span class="line">  Elf32_Addr	r_offset;		&#x2F;* Address *&#x2F;</span><br><span class="line">  Elf32_Word	r_info;			&#x2F;* Relocation type and symbol index *&#x2F;</span><br><span class="line">&#125; Elf32_Rel;</span><br><span class="line"></span><br><span class="line">&#x2F;* I have seen two different definitions of the Elf64_Rel and</span><br><span class="line">   Elf64_Rela structures, so we&#39;ll leave them out until Novell (or</span><br><span class="line">   whoever) gets their act together.  *&#x2F;</span><br><span class="line">&#x2F;* The following, at least, is used on Sparc v9, MIPS, and Alpha.  *&#x2F;</span><br><span class="line"></span><br><span class="line">typedef struct</span><br><span class="line">&#123;</span><br><span class="line">  Elf64_Addr	r_offset;		&#x2F;* Address *&#x2F;</span><br><span class="line">  Elf64_Xword	r_info;			&#x2F;* Relocation type and symbol index *&#x2F;</span><br><span class="line">&#125; Elf64_Rel;</span><br><span class="line"></span><br><span class="line">&#x2F;* Relocation table entry with addend (in section of type SHT_RELA).  *&#x2F;</span><br><span class="line"></span><br><span class="line">typedef struct</span><br><span class="line">&#123;</span><br><span class="line">  Elf32_Addr	r_offset;		&#x2F;* Address *&#x2F;</span><br><span class="line">  Elf32_Word	r_info;			&#x2F;* Relocation type and symbol index *&#x2F;</span><br><span class="line">  Elf32_Sword	r_addend;		&#x2F;* Addend *&#x2F;</span><br><span class="line">&#125; Elf32_Rela;</span><br></pre></td></tr></table></figure></div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">fancylight</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://yoursite.com/2018/09/04/elf/">http://yoursite.com/2018/09/04/elf/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://yoursite.com" target="_blank">博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%8E%9F%E7%90%86/">原理    </a></div><div class="post_share"><div class="social-share" data-image="/img/spring.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/wechat.jpg" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/alipay.jpg" alt="支付寶"/><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2018/09/05/%E6%B1%87%E7%BC%96%E7%9B%B8%E5%85%B3%E8%A6%81%E7%82%B9/"><img class="prev_cover" src="/img/post.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">汇编相关要点</div></div></a></div><div class="next-post pull_right"><a href="/2018/09/03/c++%20google%20style/"><img class="next_cover" src="/img/post.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">c++ google style.md</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2018/09/05/汇编相关要点/" title="汇编相关要点"><img class="relatedPosts_cover "src="/img/post.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2018-09-05</div><div class="relatedPosts_title">汇编相关要点</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: '624d139155758ea48077',
  clientSecret: 'cc126a301586ea63779cec6a6b53101749dbc9dd',
  repo: 'gittalk_issue',
  owner: 'fancylight',
  admin: ['fancylight'],
  id: md5(decodeURI(location.pathname)),
  language: 'zh-CN',
  perPage: 10,
  distractionFreeMode: false,
  pagerDirection: 'last',
  createIssueManually: false,
  updateCountCallback: commentCount
})
gitalk.render('gitalk-container')

function commentCount(n){
  try {
    document.getElementsByClassName('gitalk-comment-count')[0].innerHTML= n
  } catch (e) {
    return false
  }
}</script></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 By fancylight</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script></body></html>