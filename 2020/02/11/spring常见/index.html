<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>spring常见 | 博客</title><meta name="description" content="spring框架中常见的组件"><meta name="keywords" content="框架,spring,spring组件"><meta name="author" content="fancylight"><meta name="copyright" content="fancylight"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="spring常见"><meta name="twitter:description" content="spring框架中常见的组件"><meta name="twitter:image" content="https://www.fancylight.top/img/spring.png"><meta property="og:type" content="article"><meta property="og:title" content="spring常见"><meta property="og:url" content="https://www.fancylight.top/2020/02/11/spring%E5%B8%B8%E8%A7%81/"><meta property="og:site_name" content="博客"><meta property="og:description" content="spring框架中常见的组件"><meta property="og:image" content="https://www.fancylight.top/img/spring.png"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script><!-- hexo-inject:begin --><!-- hexo-inject:end -->const autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      now = new Date();
      hour = now.getHours();
      isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://www.fancylight.top/2020/02/11/spring%E5%B8%B8%E8%A7%81/"><link rel="prev" title="Spring_aop织入分析" href="https://www.fancylight.top/2020/03/04/Spring-aop%E7%BB%87%E5%85%A5%E5%88%86%E6%9E%90/"><link rel="next" title="springMVC核心" href="https://www.fancylight.top/2019/12/26/springMVC%E6%A0%B8%E5%BF%83/"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5/js/md5.min.js"></script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: true,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: false,
  highlightShrink: false,
  isFontAwesomeV5: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false
}</script><meta name="generator" content="Hexo 4.2.1"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">54</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">26</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">9</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 目录</span></a></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Bean相关"><span class="toc-number">1.</span> <span class="toc-text">Bean相关</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#xml解析"><span class="toc-number">1.1.</span> <span class="toc-text">xml解析</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#基本元素"><span class="toc-number">1.1.1.</span> <span class="toc-text">基本元素</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#custom元素"><span class="toc-number">1.1.2.</span> <span class="toc-text">custom元素</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#NamespaceHandler体系"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">NamespaceHandler体系</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#xml-和-注解实现的一些区别"><span class="toc-number">1.1.3.</span> <span class="toc-text">xml 和 注解实现的一些区别</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#BeanDefinition"><span class="toc-number">1.2.</span> <span class="toc-text">BeanDefinition</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#BeanWrapper"><span class="toc-number">1.3.</span> <span class="toc-text">BeanWrapper</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#属性类型转换"><span class="toc-number">1.3.1.</span> <span class="toc-text">属性类型转换</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#spring-post处理器"><span class="toc-number">2.</span> <span class="toc-text">spring_post处理器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LTW"><span class="toc-number">3.</span> <span class="toc-text">LTW</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MessageSource"><span class="toc-number">4.</span> <span class="toc-text">MessageSource</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#spring框架中提供的特殊调用点"><span class="toc-number">5.</span> <span class="toc-text">spring框架中提供的特殊调用点</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#spring-web关于web容器的初始化"><span class="toc-number">5.1.</span> <span class="toc-text">spring web关于web容器的初始化</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#springIo"><span class="toc-number">6.</span> <span class="toc-text">springIo</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#resource接口"><span class="toc-number">6.1.</span> <span class="toc-text">resource接口</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#ResolvingResource"><span class="toc-number">6.1.1.</span> <span class="toc-text">ResolvingResource</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#HttpResource"><span class="toc-number">6.1.2.</span> <span class="toc-text">HttpResource</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ContextResouce"><span class="toc-number">6.1.3.</span> <span class="toc-text">ContextResouce</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#ServletCOntextResouce"><span class="toc-number">6.1.3.1.</span> <span class="toc-text">ServletCOntextResouce</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ResouceLoader"><span class="toc-number">6.2.</span> <span class="toc-text">ResouceLoader</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#DefaultResourceLoader"><span class="toc-number">6.2.1.</span> <span class="toc-text">DefaultResourceLoader</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#ClassRelativeResourceLoader"><span class="toc-number">6.2.1.1.</span> <span class="toc-text">ClassRelativeResourceLoader</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#FileSystemResourceLoader"><span class="toc-number">6.2.1.2.</span> <span class="toc-text">FileSystemResourceLoader</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ResourcePatternResolver"><span class="toc-number">6.2.2.</span> <span class="toc-text">ResourcePatternResolver</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#PathMatchingResourcePatternResolver"><span class="toc-number">6.2.2.1.</span> <span class="toc-text">PathMatchingResourcePatternResolver</span></a></li></ol></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(/img/post.jpg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">博客</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 目录</span></a></div></div></span><span class="pull_right" id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div><div id="post-info"><div id="post-title"><div class="posttitle">spring常见</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2020-02-11<span class="post-meta__separator">|</span><i class="fa fa-history" aria-hidden="true"></i> 更新于 2020-04-08</time><span class="post-meta__separator">|</span><span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/java/">java</a></span><div class="post-meta-wordcount"><i class="post-meta__icon fa fa-file-word-o" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">6.8k</span><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-clock-o" aria-hidden="true"></i><span>阅读时长: 34 分钟</span><div class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-comment-o" aria-hidden="true"></i><span>评论数:</span><a href="/2020/02/11/spring%E5%B8%B8%E8%A7%81/#post-comment"><span class="gitalk-comment-count comment-count"></span></a></div></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div id="article-container"><h3 id="Bean相关"><a href="#Bean相关" class="headerlink" title="Bean相关"></a>Bean相关</h3><ul>
<!-- hexo-inject:begin --><!-- hexo-inject:end --><li>概念<ul>
<li>BeanDefinition 是将ioc定义如xml,注解扫描的类转为成抽象描述,包含了用户定义的各种bean信息</li>
<li>BeanWrapper 是从该类抽离出的低级javaBean,包含了属性转换器,以及java 原信息</li>
<li>PropertyValue 仅仅是封装key-value 表示对象,存在于Bd内部,以及ioc属性转换过程中</li>
<li>PropertyEditor jdk提供的属性转换,A-&gt;B类型的转换,ioc逻辑中使用<h4 id="xml解析"><a href="#xml解析" class="headerlink" title="xml解析"></a>xml解析</h4>简而言之, 解析xml的类是BeanDefinitionParserDelegate完成的</li>
</ul>
</li>
<li>标准bean标签的解析过程<ul>
<li>xml例子<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"test"</span> <span class="attr">class</span>=<span class="string">"com.light.Foo"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span></span><br><span class="line">        this is a test</span><br><span class="line">    <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"list"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>123<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>123<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"files"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>d:/test/12.txt<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>d:/test/12.txt<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">key</span>=<span class="string">"key1"</span> <span class="attr">value</span>=<span class="string">"value1"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h5 id="基本元素"><a href="#基本元素" class="headerlink" title="基本元素"></a>基本元素</h5><ul>
<li>前言<br>解析bean的读取器为<code>BeanDefinitionReader</code>体系,并非是仅仅支持xml.</li>
<li>外部类<pre><code>  {%codeblock lang:java DefaultBeanDefinitionDocumentReader%}
//该类是xml默认的 解析器实现类
protected void doRegisterBeanDefinitions(Element root) {
    //委托模式
        BeanDefinitionParserDelegate parent = this.delegate;
        this.delegate = createDelegate(getReaderContext(), root, parent);

        if (this.delegate.isDefaultNamespace(root)) {
            String profileSpec = root.getAttribute(PROFILE_ATTRIBUTE);
            if (StringUtils.hasText(profileSpec)) {
                String[] specifiedProfiles = StringUtils.tokenizeToStringArray(
                        profileSpec, BeanDefinitionParserDelegate.MULTI_VALUE_ATTRIBUTE_DELIMITERS);
                // We cannot use Profiles.of(...) since profile expressions are not supported
                // in XML config. See SPR-12458 for details.
                if (!getReaderContext().getEnvironment().acceptsProfiles(specifiedProfiles)) {
                    if (logger.isDebugEnabled()) {
                        logger.debug("Skipped XML bean definition file due to specified profiles [" + profileSpec +
                                "] not matching: " + getReaderContext().getResource());
                    }
                    return;
                }
            }
        }

        preProcessXml(root); //空,子类实现
        parseBeanDefinitions(root, this.delegate);
        postProcessXml(root); //空,子类实现

        this.delegate = parent;
}


//-------------------------------- 循环处理所有元素---------------------------------
    protected void parseBeanDefinitions(Element root, BeanDefinitionParserDelegate delegate) {
        if (delegate.isDefaultNamespace(root)) {
            NodeList nl = root.getChildNodes();
            for (int i = 0; i < nl.getLength(); i++) {
                Node node = nl.item(i);
                if (node instanceof Element) {
                    Element ele = (Element) node;
                    if (delegate.isDefaultNamespace(ele)) {
                        parseDefaultElement(ele, delegate); //处理不用引入如<context> 这样的默认标签
                    }
                    else {
                        delegate.parseCustomElement(ele); //处理额外的标签
                    }
                }
            }
        }
        else {
            delegate.parseCustomElement(root);
        }
    }

//-----------------------------------处理默认标签-------------------------------------------
  private void parseDefaultElement(Element ele, BeanDefinitionParserDelegate delegate) {
  if (delegate.nodeNameEquals(ele, IMPORT_ELEMENT)) {
    importBeanDefinitionResource(ele);
  }
  else if (delegate.nodeNameEquals(ele, ALIAS_ELEMENT)) {
    processAliasRegistration(ele);
  }
  else if (delegate.nodeNameEquals(ele, BEAN_ELEMENT)) {
    processBeanDefinition(ele, delegate);
  }
  else if (delegate.nodeNameEquals(ele, NESTED_BEANS_ELEMENT)) {
    // recurse
    doRegisterBeanDefinitions(ele);
  }
}
//------------------------------------处理bean标签-----------------------------------------
protected void processBeanDefinition(Element ele, BeanDefinitionParserDelegate delegate) {
  //holder仅仅用来包含BeanDefition,内部的BeanDiftion 就是GenicBeanDeition
  //[1]  解析并创建gbdH
  BeanDefinitionHolder bdHolder = delegate.parseBeanDefinitionElement(ele);
  //[1!]
  //[2] 注册bd到beanFacotry(Registry)中
  if (bdHolder != null) {
    bdHolder = delegate.decorateBeanDefinitionIfRequired(ele, bdHolder);
    try {
      // Register the final decorated instance.
      BeanDefinitionReaderUtils.registerBeanDefinition(bdHolder, getReaderContext().getRegistry());
    }
    catch (BeanDefinitionStoreException ex) {
      getReaderContext().error("Failed to register bean definition with name '" +
          bdHolder.getBeanName() + "'", ele, ex);
    }
    //[2!]
    //[3] 触发事件
    getReaderContext().fireComponentRegistered(new BeanComponentDefinition(bdHolder));
    //[3!]
  }


      {%endcodeblock%}
</code></pre></li>
<li>委托类<pre><code>{%codeblock lang:java BeanDefinitionParserDelegate%}
      //------------------------------------解析 并创建 gbd--------------------------------------
        public BeanDefinitionHolder parseBeanDefinitionElement(Element ele) {
          return parseBeanDefinitionElement(ele, null);
        }
        @Nullable
        public BeanDefinitionHolder parseBeanDefinitionElement(Element ele, @Nullable BeanDefinition containingBean) {
          //[1] 处理id和name,别名,保持id唯一性
          String id = ele.getAttribute(ID_ATTRIBUTE);
          String nameAttr = ele.getAttribute(NAME_ATTRIBUTE);

          List<String> aliases = new ArrayList<>();
          if (StringUtils.hasLength(nameAttr)) {
            String[] nameArr = StringUtils.tokenizeToStringArray(nameAttr, MULTI_VALUE_ATTRIBUTE_DELIMITERS);
            aliases.addAll(Arrays.asList(nameArr));
          }

          String beanName = id;
          if (!StringUtils.hasText(beanName) && !aliases.isEmpty()) {
            beanName = aliases.remove(0);
            if (logger.isTraceEnabled()) {
              logger.trace("No XML 'id' specified - using '" + beanName +
                  "' as bean name and " + aliases + " as aliases");
            }
          }

          if (containingBean == null) {
            checkNameUniqueness(beanName, aliases, ele);
          }
          //[1!]
          //[2]解析标签,并创建gbd
          AbstractBeanDefinition beanDefinition = parseBeanDefinitionElement(ele, beanName, containingBean);
          //[2!]
          if (beanDefinition != null) {
            if (!StringUtils.hasText(beanName)) {
              try {
                if (containingBean != null) {
                  beanName = BeanDefinitionReaderUtils.generateBeanName(
                      beanDefinition, this.readerContext.getRegistry(), true);
                }
                else {
                  beanName = this.readerContext.generateBeanName(beanDefinition);
                  // Register an alias for the plain bean class name, if still possible,
                  // if the generator returned the class name plus a suffix.
                  // This is expected for Spring 1.2/2.0 backwards compatibility.
                  String beanClassName = beanDefinition.getBeanClassName();
                  if (beanClassName != null &&
                      beanName.startsWith(beanClassName) && beanName.length() > beanClassName.length() &&
                      !this.readerContext.getRegistry().isBeanNameInUse(beanClassName)) {
                    aliases.add(beanClassName);
                  }
                }
                if (logger.isTraceEnabled()) {
                  logger.trace("Neither XML 'id' nor 'name' specified - " +
                      "using generated bean name [" + beanName + "]");
                }
              }
              catch (Exception ex) {
                error(ex.getMessage(), ele);
                return null;
              }
            }
            String[] aliasesArray = StringUtils.toStringArray(aliases);
            return new BeanDefinitionHolder(beanDefinition, beanName, aliasesArray);
          }

          return null;
        }
        //----------------------------------实际创建gbd的代码---------------------------
        public AbstractBeanDefinition parseBeanDefinitionElement(
            Element ele, String beanName, @Nullable BeanDefinition containingBean) {

          this.parseState.push(new BeanEntry(beanName));

          String className = null;
          //class属性
          if (ele.hasAttribute(CLASS_ATTRIBUTE)) {
            className = ele.getAttribute(CLASS_ATTRIBUTE).trim();
          }
          String parent = null;
          //parent属性
          if (ele.hasAttribute(PARENT_ATTRIBUTE)) {
            parent = ele.getAttribute(PARENT_ATTRIBUTE);
          }

          try {
            // 简单创建gbd实例
            AbstractBeanDefinition bd = createBeanDefinition(className, parent);
            // 处理<bean> 标签中所有的属性,即attr,设置为abd(AbstractBeanDefinition) 对应的属性
            parseBeanDefinitionAttributes(ele, beanName, containingBean, bd);
            // 子类node中寻找 获取desc
            bd.setDescription(DomUtils.getChildElementValueByTagName(ele, DESCRIPTION_ELEMENT));
            //  此处代码见下边
            parseMetaElements(ele, bd);
            // 子类node寻找<lookUp  name="" ,bean=""> 元素,添加MethodOverrride对象到bd中
            parseLookupOverrideSubElements(ele, bd.getMethodOverrides());
            // 寻找<ReplaceMethod name="" repalcer="">  元素 添加MEthodOverride对象到bd中
            parseReplacedMethodSubElements(ele, bd.getMethodOverrides());
            // 处理<constructor-arg index= ...>
            // bd.getConstructorArgumentValues().addGenericArgumentValue(valueHolder);
            // valueHolder就是解析后创建的要添加到bd中的对象  
            parseConstructorArgElements(ele, bd);
            //处理子类中属性
            parsePropertyElements(ele, bd);
            //处理qualifier标签
            parseQualifierElements(ele, bd);
            //bd来源,如xml的路径  
            bd.setResource(this.readerContext.getResource());
            //
            bd.setSource(extractSource(ele));

            return bd;
          }
           //...

          return null;
        }
        //------------------------------处理meta元素-----------------------
        public void parseMetaElements(Element ele, BeanMetadataAttributeAccessor attributeAccessor) {
          //从子类寻<meta>标签,获取meat的key以及value属性,作为bd#attribute
          NodeList nl = ele.getChildNodes();
          for (int i = 0; i < nl.getLength(); i++) {
            Node node = nl.item(i);
            if (isCandidateElement(node) && nodeNameEquals(node, META_ELEMENT)) {
              Element metaElement = (Element) node;
              //这里就能知道BeanMetadataAttributeAccessor的map是什么情况可以设置的
              String key = metaElement.getAttribute(KEY_ATTRIBUTE);
              String value = metaElement.getAttribute(VALUE_ATTRIBUTE);
              //此处体现了BD体系中如何使用key-value
              BeanMetadataAttribute attribute = new BeanMetadataAttribute(key, value);
              attribute.setSource(extractSource(metaElement));
              attributeAccessor.addMetadataAttribute(attribute);
            }
          }
        }
        //----------------------------处理property----------------------------
        public void parsePropertyElement(Element ele, BeanDefinition bd) {
        String propertyName = ele.getAttribute(NAME_ATTRIBUTE); //获取该propery名
        if (!StringUtils.hasLength(propertyName)) {
            error("Tag 'property' must have a 'name' attribute", ele);
            return;
        }
        this.parseState.push(new PropertyEntry(propertyName));
        try {
            if (bd.getPropertyValues().contains(propertyName)) {
                error("Multiple 'property' definitions for property '" + propertyName + "'", ele);
                return;
            }
      //此处是具体代码
            Object val = parsePropertyValue(ele, bd, propertyName);
      //返回值创建pv (key-vlaue) 类型
            PropertyValue pv = new PropertyValue(propertyName, val);
            parseMetaElements(ele, pv);
            pv.setSource(extractSource(ele));
      //添加到bd#pvs中,这个pvs在ioc中注值使用,非常关键
            bd.getPropertyValues().addPropertyValue(pv);
        }
        finally {
            this.parseState.pop();
        }
    }

  public Object parsePropertyValue(Element ele, BeanDefinition bd, @Nullable String propertyName) {
        String elementName = (propertyName != null ?
                "<property> element for property '" + propertyName + "'" :
                "<constructor-arg> element");

        // Should only have one child element: ref, value, list, etc.
    //[1]获取当前元素(即Property) 子元素,最多最外层 只能存在一个如上
        NodeList nl = ele.getChildNodes();
        Element subElement = null;
        for (int i = 0; i < nl.getLength(); i++) {
            Node node = nl.item(i);
            if (node instanceof Element && !nodeNameEquals(node, DESCRIPTION_ELEMENT) &&
                    !nodeNameEquals(node, META_ELEMENT)) {
                // Child element is what we're looking for.
                if (subElement != null) {
                    error(elementName + " must not contain more than one sub-element", ele);
                }
                else {
                    subElement = (Element) node;
                }
            }
        }
    //[1!]
    //[2] 不允许property元素带有value和ref属性, 或者任意属性并且有子元素
        boolean hasRefAttribute = ele.hasAttribute(REF_ATTRIBUTE);
        boolean hasValueAttribute = ele.hasAttribute(VALUE_ATTRIBUTE);
        if ((hasRefAttribute && hasValueAttribute) ||
                ((hasRefAttribute || hasValueAttribute) && subElement != null)) {
            error(elementName +
                    " is only allowed to contain either 'ref' attribute OR 'value' attribute OR sub-element", ele);
        }
    //[2]
    //[3] 分情况讨论
        if (hasRefAttribute) {
            String refName = ele.getAttribute(REF_ATTRIBUTE);
            if (!StringUtils.hasText(refName)) {
                error(elementName + " contains empty 'ref' attribute", ele);
            }
            RuntimeBeanReference ref = new RuntimeBeanReference(refName);//创建一个引用
            ref.setSource(extractSource(ele));
            return ref;
        } //ref情况返回
        else if (hasValueAttribute) {
            TypedStringValue valueHolder = new TypedStringValue(ele.getAttribute(VALUE_ATTRIBUTE));
            valueHolder.setSource(extractSource(ele));
            return valueHolder;
        }//value 类型
        else if (subElement != null) {
            return parsePropertySubElement(subElement, bd); //复杂情况,即property存在子元素
        }
        else {
            // Neither child element nor "ref" or "value" attribute found.
            error(elementName + " must specify a ref or value", ele);
            return null;
        }
    [3!]
    }
  //-------------------------------处理property子元素------------------------------------
  public Object parsePropertySubElement(Element ele, @Nullable BeanDefinition bd, @Nullable String defaultValueType) {
    //[1]
        if (!isDefaultNamespace(ele)) {
            return parseNestedCustomElement(ele, bd); //非标准元素,去调用custom逻辑,见下文
        }
    //[1!]
    //[2]
        else if (nodeNameEquals(ele, BEAN_ELEMENT)) {
       //Bean标签,相当于递归调用
            BeanDefinitionHolder nestedBd = parseBeanDefinitionElement(ele, bd);
            if (nestedBd != null) {
                nestedBd = decorateBeanDefinitionIfRequired(ele, nestedBd, bd);
            }
            return nestedBd;
        }
    //[2!]
    //[3]
        else if (nodeNameEquals(ele, REF_ELEMENT)) {
            // A generic reference to any name of any bean.
            String refName = ele.getAttribute(BEAN_REF_ATTRIBUTE);
            boolean toParent = false;
            if (!StringUtils.hasLength(refName)) {
                // A reference to the id of another bean in a parent context.
                refName = ele.getAttribute(PARENT_REF_ATTRIBUTE);
                toParent = true;
                if (!StringUtils.hasLength(refName)) {
                    error("'bean' or 'parent' is required for <ref> element", ele);
                    return null;
                }
            }
            if (!StringUtils.hasText(refName)) {
                error("<ref> element contains empty target attribute", ele);
                return null;
            }
            RuntimeBeanReference ref = new RuntimeBeanReference(refName, toParent);
            ref.setSource(extractSource(ele));
            return ref;// <ref bean=""> 处理
        }
    //[4]
    //[5] <idref bean=""> 此处应该只能填写id
        else if (nodeNameEquals(ele, IDREF_ELEMENT)) {
            return parseIdRefElement(ele);
        }
    //[5!]
    //[6] <value >处理
        else if (nodeNameEquals(ele, VALUE_ELEMENT)) {
            return parseValueElement(ele, defaultValueType);
        }//[6!]
        else if (nodeNameEquals(ele, NULL_ELEMENT)) {
            // It's a distinguished null value. Let's wrap it in a TypedStringValue
            // object in order to preserve the source location.
            TypedStringValue nullHolder = new TypedStringValue(null);
            nullHolder.setSource(extractSource(ele));
            return nullHolder;
        }
    // 这几个类型 可能会继续引起子 解析,
        else if (nodeNameEquals(ele, ARRAY_ELEMENT)) {
            return parseArrayElement(ele, bd);
        }
        else if (nodeNameEquals(ele, LIST_ELEMENT)) {
            return parseListElement(ele, bd);
        }
        else if (nodeNameEquals(ele, SET_ELEMENT)) {
            return parseSetElement(ele, bd);
        }
        else if (nodeNameEquals(ele, MAP_ELEMENT)) {
            return parseMapElement(ele, bd);
        }
        else if (nodeNameEquals(ele, PROPS_ELEMENT)) {
            return parsePropsElement(ele);
        }
        else {
            error("Unknown property sub-element: [" + ele.getNodeName() + "]", ele);
            return null;
        }
    }
      {%endcodeblock%}
</code></pre><h5 id="custom元素"><a href="#custom元素" class="headerlink" title="custom元素"></a>custom元素</h5><h6 id="NamespaceHandler体系"><a href="#NamespaceHandler体系" class="headerlink" title="NamespaceHandler体系"></a>NamespaceHandler体系</h6></li>
<li>调用点<figure class="highlight java"><figcaption><span>BeanDefinitionParserDelegate</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> BeanDefinition <span class="title">parseCustomElement</span><span class="params">(Element ele)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> parseCustomElement(ele, <span class="keyword">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> BeanDefinition <span class="title">parseCustomElement</span><span class="params">(Element ele, @Nullable BeanDefinition containingBd)</span> </span>&#123;</span><br><span class="line">    String namespaceUri = getNamespaceURI(ele);</span><br><span class="line">    <span class="keyword">if</span> (namespaceUri == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//根据不同的元素使用不同的handler 来处理</span></span><br><span class="line">    NamespaceHandler handler = <span class="keyword">this</span>.readerContext.getNamespaceHandlerResolver().resolve(namespaceUri);</span><br><span class="line">    <span class="keyword">if</span> (handler == <span class="keyword">null</span>) &#123;</span><br><span class="line">        error(<span class="string">"Unable to locate Spring NamespaceHandler for XML schema namespace ["</span> + namespaceUri + <span class="string">"]"</span>, ele);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> handler.parse(ele, <span class="keyword">new</span> ParserContext(<span class="keyword">this</span>.readerContext, <span class="keyword">this</span>, containingBd));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>继承树</p>
<img src="/2020/02/11/spring%E5%B8%B8%E8%A7%81/BeanDetintionParser.png" class="">
<p>简单来看实际最多的是直接子类,另一类是</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">BeanDefinitionParser</span><br><span class="line">    AbstractBeanDefinitionParser</span><br><span class="line">        AbstractSingleBeanDefinitionParser</span><br></pre></td></tr></table></figure>
</li>
<li><p>抽象逻辑</p>
<pre><code>  {%codeblock lang:java AbstractBeanDefinitionParser%}
            public abstract class AbstractBeanDefinitionParser implements BeanDefinitionParser {
                public static final String ID_ATTRIBUTE = "id";
                public static final String NAME_ATTRIBUTE = "name";
                public final BeanDefinition parse(Element element, ParserContext parserContext) {
		AbstractBeanDefinition definition = parseInternal(element, parserContext); //子类实现解析bd
		if (definition != null && !parserContext.isNested()) {
			try {
                //尝试获得id
				String id = resolveId(element, definition, parserContext);
				if (!StringUtils.hasText(id)) {
					parserContext.getReaderContext().error(
							"Id is required for element '" + parserContext.getDelegate().getLocalName(element)
									+ "' when used as a top-level tag", element);
				}
                //别名
				String[] aliases = null;
				if (shouldParseNameAsAliases()) {
					String name = element.getAttribute(NAME_ATTRIBUTE);
					if (StringUtils.hasLength(name)) {
						aliases = StringUtils.trimArrayElements(StringUtils.commaDelimitedListToStringArray(name));
					}
				}
                //注册
				BeanDefinitionHolder holder = new BeanDefinitionHolder(definition, id, aliases);
				registerBeanDefinition(holder, parserContext.getRegistry());
				if (shouldFireEvents()) { //抽象类流出的接口
					BeanComponentDefinition componentDefinition = new BeanComponentDefinition(holder);
					postProcessComponentDefinition(componentDefinition);
					parserContext.registerComponent(componentDefinition);
				}
			}
			catch (BeanDefinitionStoreException ex) {
				String msg = ex.getMessage();
				parserContext.getReaderContext().error((msg != null ? msg : ex.toString()), element);
				return null;
			}
		}
		return definition;
	}
        }
        {%endcodeblock%}
</code></pre><ul>
<li><p>AbstractSingleBeanDefinitionParser</p>
<p>   该类表示此标签仅仅创建一个bd,例如<code>&lt;context:property-placeholder</code>的结果</p>
  <figure class="highlight java"><figcaption><span>AbstractSingleBeanDefinitionParser</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">       <span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> AbstractBeanDefinition <span class="title">parseInternal</span><span class="params">(Element element, ParserContext parserContext)</span> </span>&#123;</span><br><span class="line">       <span class="comment">//bdBuidler用来创建bd,这里的getXX都是子类实现的</span></span><br><span class="line">	BeanDefinitionBuilder builder = BeanDefinitionBuilder.genericBeanDefinition();</span><br><span class="line">	String parentName = getParentName(element);<span class="comment">//子类获取</span></span><br><span class="line">	<span class="keyword">if</span> (parentName != <span class="keyword">null</span>) &#123;</span><br><span class="line">		builder.getRawBeanDefinition().setParentName(parentName);</span><br><span class="line">	&#125;</span><br><span class="line">	Class&lt;?&gt; beanClass = getBeanClass(element);</span><br><span class="line">	<span class="keyword">if</span> (beanClass != <span class="keyword">null</span>) &#123;</span><br><span class="line">		builder.getRawBeanDefinition().setBeanClass(beanClass);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		String beanClassName = getBeanClassName(element);</span><br><span class="line">		<span class="keyword">if</span> (beanClassName != <span class="keyword">null</span>) &#123;</span><br><span class="line">			builder.getRawBeanDefinition().setBeanClassName(beanClassName);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	builder.getRawBeanDefinition().setSource(parserContext.extractSource(element));</span><br><span class="line">	BeanDefinition containingBd = parserContext.getContainingBeanDefinition();</span><br><span class="line">	<span class="keyword">if</span> (containingBd != <span class="keyword">null</span>) &#123;</span><br><span class="line">		<span class="comment">// Inner bean definition must receive same scope as containing bean.</span></span><br><span class="line">		builder.setScope(containingBd.getScope());</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (parserContext.isDefaultLazyInit()) &#123;</span><br><span class="line">		<span class="comment">// Default-lazy-init applies to custom bean definitions as well.</span></span><br><span class="line">		builder.setLazyInit(<span class="keyword">true</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	doParse(element, parserContext, builder); <span class="comment">//再添加一些必要的属性</span></span><br><span class="line">	<span class="keyword">return</span> builder.getBeanDefinition();<span class="comment">//构建bd</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">       </span><br></pre></td></tr></table></figure>
<h5 id="xml-和-注解实现的一些区别"><a href="#xml-和-注解实现的一些区别" class="headerlink" title="xml 和 注解实现的一些区别"></a>xml 和 注解实现的一些区别</h5></li>
</ul>
</li>
<li>单纯使用xml的话,gbd创建会包含所有的信息,如pvs,各种ioc属性</li>
<li>注解的话很多都要进行后处理器来处理<ul>
<li>name一个String类型  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span></span><br><span class="line">  zhangsan</span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>注解实现<pre><code>      <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value</span>(<span class="string">"张三"</span>)</span><br><span class="line"><span class="keyword">private</span> String name;</span><br></pre></td></tr></table></figure>
</code></pre></li>
<li>前者会在为gbd#pvs,后者必须经过AutowiredAnnotationBeanPostProcessor(@AutoWire,@Value,@Inject)处理     </li>
</ul>
</li>
</ul>
<h4 id="BeanDefinition"><a href="#BeanDefinition" class="headerlink" title="BeanDefinition"></a>BeanDefinition</h4><img src="/2020/02/11/spring%E5%B8%B8%E8%A7%81/RootBeanDetinition.png" class="" title="RootBeanDetinition">
<p>spring常见的接口设计模式:</p>
<ul>
<li>RootBeanDetinition实质是一个AttributeAccessor和BeanDefinition</li>
<li>属于AttributeAccessor的部分由父类BeanMetadataAttributeAccessor实现</li>
<li>AttributeAccessor:该接口定义如何访问源信息中的属性,在Bd体系中,通过 ‘BeanMetadataAttribut’,作为meta 原信息体现key-value<ul>
<li>AttributeAccessor<figure class="highlight java"><figcaption><span>AttributeAccessor</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setAttribute</span><span class="params">(String name, @Nullable Object value)</span></span>;</span><br><span class="line">    <span class="function">Object <span class="title">getAttribute</span><span class="params">(String name)</span></span>;</span><br><span class="line">    <span class="function">Object <span class="title">removeAttribute</span><span class="params">(String name)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">hasAttribute</span><span class="params">(String name)</span></span>;</span><br><span class="line">    String[] attributeNames();</span><br><span class="line">      </span><br></pre></td></tr></table></figure></li>
<li>AttributeAccessorSupport<figure class="highlight java"><figcaption><span>AttributeAccessorSupport</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">//该map就是属性储存的位置,在该体系中,此map表示的是bean的一些附加信息,跟属性无关</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Object&gt; attributes = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAttribute</span><span class="params">(String name, @Nullable Object value)</span> </span>&#123;</span><br><span class="line">    Assert.notNull(name, <span class="string">"Name must not be null"</span>);</span><br><span class="line">    <span class="keyword">if</span> (value != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.attributes.put(name, value);</span><br><span class="line">    &#125;:</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        removeAttribute(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br></pre></td></tr></table></figure></li>
<li>BeanMetadataAttributeAccessor<img src="/2020/02/11/spring%E5%B8%B8%E8%A7%81/BeanMetadataAttributeAccessor.png" class="">
<figure class="highlight java"><figcaption><span>BeanMetadataAttributeAccessor</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">      <span class="comment">//包含了要进行配置的对象</span></span><br><span class="line">      <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BeanMetadataElement</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Return the configuration source &#123;<span class="doctag">@code</span> Object&#125; for this metadata element</span></span><br><span class="line"><span class="comment">     * (may be &#123;<span class="doctag">@code</span> null&#125;).</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="function">Object <span class="title">getSource</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">* Holder <span class="keyword">for</span> a key-value style attribute that is part of a bean definition.</span><br><span class="line">* Keeps track of the definition source in addition to the key-value pair.</span><br><span class="line">*</span><br><span class="line">* <span class="meta">@author</span> Juergen Hoeller</span><br><span class="line">* <span class="meta">@since</span> <span class="number">2.5</span></span><br><span class="line">*/</span><br><span class="line"><span class="comment">//包含了source中一个属性的键值对,可以理解为pair</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanMetadataAttribute</span> <span class="keyword">implements</span> <span class="title">BeanMetadataElement</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Nullable</span></span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">final</span> Object value;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Nullable</span></span><br><span class="line"> <span class="keyword">private</span> Object source;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Extension of &#123;<span class="doctag">@link</span> org.springframework.core.AttributeAccessorSupport&#125;,</span></span><br><span class="line"><span class="comment"> * holding attributes as &#123;<span class="doctag">@link</span> BeanMetadataAttribute&#125; objects in order</span></span><br><span class="line"><span class="comment"> * to keep track of the definition source.</span></span><br><span class="line"><span class="comment"> * 该类用来访问source中属性,属性由BeanMetaDataAttribute包装</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Juergen Hoeller</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2.5</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SuppressWarnings</span>(<span class="string">"serial"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanMetadataAttributeAccessor</span> <span class="keyword">extends</span> <span class="title">AttributeAccessorSupport</span> <span class="keyword">implements</span> <span class="title">BeanMetadataElement</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Nullable</span></span><br><span class="line">      <span class="keyword">private</span> Object source;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * Set the configuration source &#123;<span class="doctag">@code</span> Object&#125; for this metadata element.</span></span><br><span class="line"><span class="comment">       * &lt;p&gt;The exact type of the object will depend on the configuration mechanism used.</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSource</span><span class="params">(@Nullable Object source)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">this</span>.source = source;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="meta">@Nullable</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> Object <span class="title">getSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">this</span>.source;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * Add the given BeanMetadataAttribute to this accessor's set of attributes.</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> attribute the BeanMetadataAttribute object to register</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addMetadataAttribute</span><span class="params">(BeanMetadataAttribute attribute)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">super</span>.setAttribute(attribute.getName(), attribute);</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br><span class="line">      </span><br></pre></td></tr></table></figure>
<img src="/2020/02/11/spring%E5%B8%B8%E8%A7%81/ScannedGenericBeanDefinition.png" class="">
此时的source用来说明bd的来源,该类型会在注册到<code>BeanFactory</code>时被转换为<code>RootBeanDefintion</code>类型<br>图中propertyValues,是xml处理<propery>时添加的字面属性,在ioc过程中pvs要经过类型转换,以及各种处理器.</li>
</ul>
</li>
<li>BeanDefinition:该接口实质是描述了springBean配置</li>
<li>常见子类ScannedGenericBeanDefinition和GenericBeanDefinition  <figure class="highlight java"><figcaption><span>BeanDefinition</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setScope</span><span class="params">(@Nullable String scope)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setLazyInit</span><span class="params">(<span class="keyword">boolean</span> lazyInit)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setDependsOn</span><span class="params">(@Nullable String... dependsOn)</span></span>;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<h4 id="BeanWrapper"><a href="#BeanWrapper" class="headerlink" title="BeanWrapper"></a>BeanWrapper</h4><img src="/2020/02/11/spring%E5%B8%B8%E8%A7%81/BeanWrapper.png" class="" title="BeanWrapper"></li>
<li>PropertyEditorRegistry 和 TypeConverter组成属性转换器<h5 id="属性类型转换"><a href="#属性类型转换" class="headerlink" title="属性类型转换"></a>属性类型转换</h5><img src="/2020/02/11/spring%E5%B8%B8%E8%A7%81/Property.png" class="" title="PropertyEditorRegistry"></li>
<li><p>PropertyEditor是jdk提供的接口,用来进行属性类型转换的</p>
  <figure class="highlight java"><figcaption><span>PropertyEditor</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PropertyEditor</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">setValue</span><span class="params">(Object value)</span></span>;</span><br><span class="line">        <span class="comment">//将转递的stirng类型进行转换</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">setAsText</span><span class="params">(String text)</span> <span class="keyword">throws</span> java.lang.IllegalArgumentException</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="comment">//一般继承该接口</span></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PropertyEditorSupport</span> <span class="keyword">implements</span> <span class="title">PropertyEditor</span> </span>&#123;</span><br><span class="line">      <span class="keyword">private</span> Object value;</span><br><span class="line">      <span class="keyword">private</span> Object source;</span><br><span class="line">      <span class="keyword">private</span> java.util.Vector&lt;PropertyChangeListener&gt; listeners;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="title">PropertyEditorSupport</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      setSource(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">PropertyEditorSupport</span><span class="params">(Object source)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (source == <span class="keyword">null</span>) &#123;</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">      &#125;</span><br><span class="line">      setSource(source);</span><br><span class="line">  &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//spirng中的一个实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ByteArrayPropertyEditor</span> <span class="keyword">extends</span> <span class="title">PropertyEditorSupport</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAsText</span><span class="params">(@Nullable String text)</span> </span>&#123;</span><br><span class="line">        setValue(text != <span class="keyword">null</span> ? text.getBytes() : <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAsText</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">byte</span>[] value = (<span class="keyword">byte</span>[]) getValue();</span><br><span class="line">        <span class="keyword">return</span> (value != <span class="keyword">null</span> ? <span class="keyword">new</span> String(value) : <span class="string">""</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;    </span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<ul>
<li><p>PropertyEditor使用</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.当类型String-&gt;Type转换</span></span><br><span class="line"><span class="comment">//调用setText()</span></span><br><span class="line"><span class="comment">//2.当其他类型-&gt;Type</span></span><br><span class="line"><span class="comment">//调用setValue()</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>PropertyEditorRegistrySupport使用Map存储PropertyEditor</p>
  <figure class="highlight java"><figcaption><span>PropertyEditorRegistrySupport</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PropertyEditorRegistrySupport</span> <span class="keyword">implements</span> <span class="title">PropertyEditorRegistry</span> </span>&#123;</span><br><span class="line"><span class="comment">//spring 实现的类型转换器,先略过    </span></span><br><span class="line">  <span class="meta">@Nullable</span></span><br><span class="line">  <span class="keyword">private</span> ConversionService conversionService;</span><br><span class="line"><span class="comment">//默认的类型转换器</span></span><br><span class="line"><span class="keyword">private</span> Map&lt;Class&lt;?&gt;, PropertyEditor&gt; defaultEditors;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">createDefaultEditors</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.defaultEditors.put(Charset<span class="class">.<span class="keyword">class</span>, <span class="title">new</span> <span class="title">CharsetEditor</span>())</span>;</span><br><span class="line">      <span class="keyword">this</span>.defaultEditors.put(Class<span class="class">.<span class="keyword">class</span>, <span class="title">new</span> <span class="title">ClassEditor</span>())</span>;</span><br><span class="line">      <span class="keyword">this</span>.defaultEditors.put(Class[]<span class="class">.<span class="keyword">class</span>, <span class="title">new</span> <span class="title">ClassArrayEditor</span>())</span>;</span><br><span class="line">  <span class="comment">//....添加了大量的类型转换器</span></span><br><span class="line">&#125;</span><br><span class="line">  </span><br></pre></td></tr></table></figure></li>
<li>TypeConverterDelegate作为委托模式用来真正处理类型转换  <figure class="highlight java"><figcaption><span>TypeConverterSupport</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">TypeConverterSupport</span> <span class="keyword">extends</span> <span class="title">PropertyEditorRegistrySupport</span> <span class="keyword">implements</span> <span class="title">TypeConverter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    TypeConverterDelegate typeConverterDelegate;</span><br><span class="line">  <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">convertIfNecessary</span><span class="params">(@Nullable Object value, @Nullable Class&lt;T&gt; requiredType,</span></span></span><br><span class="line"><span class="function"><span class="params">            @Nullable TypeDescriptor typeDescriptor)</span> <span class="keyword">throws</span> TypeMismatchException </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.typeConverterDelegate.convertIfNecessary(<span class="keyword">null</span>, <span class="keyword">null</span>, value, requiredType,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//委托逻辑</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TypeConverterDelegate</span> </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  *  propertyName 表示属性名</span></span><br><span class="line"><span class="comment">  *  oldValue 表示旧值,若该函数是pvs设值时调用一般是null</span></span><br><span class="line"><span class="comment">  *  newValue 表示此次要设置的值,也是要处理进行类型 转换的值</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">convertIfNecessary</span><span class="params">(@Nullable String propertyName, @Nullable Object oldValue, @Nullable Object newValue,</span></span></span><br><span class="line"><span class="function"><span class="params">@Nullable Class&lt;T&gt; requiredType, @Nullable TypeDescriptor typeDescriptor)</span> <span class="keyword">throws</span> IllegalArgumentException </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Custom editor for this type?</span></span><br><span class="line"><span class="comment">//获取自定义的属性编辑器</span></span><br><span class="line">PropertyEditor editor = <span class="keyword">this</span>.propertyEditorRegistry.findCustomEditor(requiredType, propertyName);</span><br><span class="line"></span><br><span class="line">ConversionFailedException conversionAttemptEx = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// No custom editor but custom ConversionService specified?</span></span><br><span class="line"><span class="comment">// 尝试使用ConversionService进行转换</span></span><br><span class="line">ConversionService conversionService = <span class="keyword">this</span>.propertyEditorRegistry.getConversionService();</span><br><span class="line"><span class="keyword">if</span> (editor == <span class="keyword">null</span> &amp;&amp; conversionService != <span class="keyword">null</span> &amp;&amp; newValue != <span class="keyword">null</span> &amp;&amp; typeDescriptor != <span class="keyword">null</span>) &#123;</span><br><span class="line">TypeDescriptor sourceTypeDesc = TypeDescriptor.forObject(newValue);</span><br><span class="line"><span class="keyword">if</span> (conversionService.canConvert(sourceTypeDesc, typeDescriptor)) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (T) conversionService.convert(newValue, sourceTypeDesc, typeDescriptor);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span> (ConversionFailedException ex) &#123;</span><br><span class="line">    <span class="comment">// fallback to default conversion logic below</span></span><br><span class="line">    conversionAttemptEx = ex;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Object convertedValue = newValue;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Value not of required type?</span></span><br><span class="line"><span class="keyword">if</span> (editor != <span class="keyword">null</span> || (requiredType != <span class="keyword">null</span> &amp;&amp; !ClassUtils.isAssignableValue(requiredType, convertedValue))) &#123; <span class="comment">//没有自定义编辑器或者 不能直接分配(即newValue需要进行向requiredType的转换)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (typeDescriptor != <span class="keyword">null</span> &amp;&amp; requiredType != <span class="keyword">null</span> &amp;&amp; Collection<span class="class">.<span class="keyword">class</span>.<span class="title">isAssignableFrom</span>(<span class="title">requiredType</span>) &amp;&amp;</span></span><br><span class="line"><span class="class">    <span class="title">convertedValue</span> <span class="title">instanceof</span> <span class="title">String</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//此处代码逻辑 是 当属性为Collection&lt;Class&gt;|Collection&lt;Eunm&gt; 时,可以将该字符串当作CSV转化    </span></span><br><span class="line">  TypeDescriptor elementTypeDesc = typeDescriptor.getElementTypeDescriptor();</span><br><span class="line">  <span class="keyword">if</span> (elementTypeDesc != <span class="keyword">null</span>) &#123;</span><br><span class="line">    Class&lt;?&gt; elementType = elementTypeDesc.getType();</span><br><span class="line">    <span class="keyword">if</span> (Class<span class="class">.<span class="keyword">class</span> </span>== elementType || Enum<span class="class">.<span class="keyword">class</span>.<span class="title">isAssignableFrom</span>(<span class="title">elementType</span>)) </span>&#123;</span><br><span class="line">      convertedValue = StringUtils.commaDelimitedListToStringArray((String) convertedValue);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (editor == <span class="keyword">null</span>) &#123;</span><br><span class="line">  <span class="comment">// 根据requiredType从map中获取对应的propertyEditor</span></span><br><span class="line">  editor = findDefaultEditor(requiredType);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//进行转换</span></span><br><span class="line">convertedValue = doConvertValue(oldValue, convertedValue, requiredType, editor);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">boolean</span> standardConversion = <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//....下边的逻辑是对于不能直接适配的情况,进一步的标准处理</span></span><br></pre></td></tr></table></figure>
<img src="/2020/02/11/spring%E5%B8%B8%E8%A7%81/doConvertValue.png" class="" title="doConvertValue">
<figure class="highlight java"><figcaption><span>doConvertValue</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//实际转换逻辑</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> Object <span class="title">doConvertValue</span><span class="params">(@Nullable Object oldValue, @Nullable Object newValue,</span></span></span><br><span class="line"><span class="function"><span class="params">            @Nullable Class&lt;?&gt; requiredType, @Nullable PropertyEditor editor)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Object convertedValue = newValue;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (editor != <span class="keyword">null</span> &amp;&amp; !(convertedValue <span class="keyword">instanceof</span> String)) &#123;</span><br><span class="line">      <span class="comment">//一般来说spring基本都是将string类型进行转换,但是如果此处的value并不是String,</span></span><br><span class="line">      <span class="comment">//那么就要调用PropertyEditor的setValue进行转换,然后再get出来,这个set逻辑要</span></span><br><span class="line">      <span class="comment">//用户自己实现,或者spring内部提供了对应的转换器</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                editor.setValue(convertedValue);</span><br><span class="line">                Object newConvertedValue = editor.getValue();</span><br><span class="line">                <span class="keyword">if</span> (newConvertedValue != convertedValue) &#123;</span><br><span class="line">                    convertedValue = newConvertedValue;</span><br><span class="line">                    <span class="comment">// Reset PropertyEditor: It already did a proper conversion.</span></span><br><span class="line">                    <span class="comment">// Don't use it again for a setAsText call.</span></span><br><span class="line">                    editor = <span class="keyword">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">                <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">                    logger.debug(<span class="string">"PropertyEditor ["</span> + editor.getClass().getName() + <span class="string">"] does not support setValue call"</span>, ex);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// Swallow and proceed.</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Object returnValue = convertedValue;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (requiredType != <span class="keyword">null</span> &amp;&amp; !requiredType.isArray() &amp;&amp; convertedValue <span class="keyword">instanceof</span> String[]) &#123;</span><br><span class="line">          <span class="comment">//若转换类型不为数组,并且给定的value为String数组,则将value转为成CVS</span></span><br><span class="line">            <span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">                logger.trace(<span class="string">"Converting String array to comma-delimited String ["</span> + convertedValue + <span class="string">"]"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            convertedValue = StringUtils.arrayToCommaDelimitedString((String[]) convertedValue);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//若经过上述两操作,cV还是String,那么就可以执行Text类型转换</span></span><br><span class="line">        <span class="keyword">if</span> (convertedValue <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">            <span class="keyword">if</span> (editor != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// Use PropertyEditor's setAsText in case of a String value.</span></span><br><span class="line">                <span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">                    logger.trace(<span class="string">"Converting String to ["</span> + requiredType + <span class="string">"] using property editor ["</span> + editor + <span class="string">"]"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                String newTextValue = (String) convertedValue;</span><br><span class="line">                <span class="keyword">return</span> doConvertTextValue(oldValue, newTextValue, editor);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (String<span class="class">.<span class="keyword">class</span> </span>== requiredType) &#123;</span><br><span class="line">                returnValue = convertedValue;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> returnValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> Object <span class="title">doConvertTextValue</span><span class="params">(@Nullable Object oldValue, String newTextValue, PropertyEditor editor)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            editor.setValue(oldValue);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">                logger.debug(<span class="string">"PropertyEditor ["</span> + editor.getClass().getName() + <span class="string">"] does not support setValue call"</span>, ex);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// Swallow and proceed.</span></span><br><span class="line">        &#125;</span><br><span class="line">        editor.setAsText(newTextValue);</span><br><span class="line">        <span class="keyword">return</span> editor.getValue();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">      </span><br></pre></td></tr></table></figure></li>
<li>例子<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Sub sub;</span><br><span class="line">    <span class="keyword">private</span> List list;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;test&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String name;  <span class="comment">//不需要转换,$&#123;test&#125;从ev中获取</span></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"D:/1.txt"</span>)    </span><br><span class="line">    <span class="keyword">private</span> File file;    <span class="comment">//通过FileEditor 转换</span></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"1,2,3,4"</span>)</span><br><span class="line">    <span class="keyword">private</span> String[] test2; <span class="comment">//通过StringArrayEditor 直接转换</span></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"I:/BaiduNetdisk/api-ms-win-core-console-l1-1-0.dll,I:/BaiduNetdisk/api-ms-win-core-datetime-l1-1-0.dll"</span>)</span><br><span class="line">    <span class="keyword">private</span> List&lt;File&gt; files; <span class="comment">//先通过CustomCollectionEditor ,再通过FileEditor转换</span></span><br><span class="line">    <span class="comment">//但是默认情况下,这个转换器并不能正确处理这种类型</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">//private File[] files   //没有该类型转换器</span></span><br></pre></td></tr></table></figure>
这里描述一下非基础类型数组|集合转换逻辑<br>convertIfNecessary-&gt;判断能否进行CVS处理,如果不行则执行CustomCollectionEditor转换,结果是一个<br>单个 元素list,后续逻辑中 进行遍历,再调用convertIfNecessary,那么结果一定是错的.<ul>
<li>添加自定义编辑器<br>通过CustomEditorConfigurer实现,这是一个BF_post<h3 id="spring-post处理器"><a href="#spring-post处理器" class="headerlink" title="spring_post处理器"></a>spring_post处理器</h3></li>
</ul>
</li>
<li>BeanPostProcessor<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BeanPostProcessor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">default</span> Object <span class="title">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="function"><span class="keyword">default</span> Object <span class="title">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>MergedBeanDefinitionPostProcessor<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MergedBeanDefinitionPostProcessor</span> <span class="keyword">extends</span> <span class="title">BeanPostProcessor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">postProcessMergedBeanDefinition</span><span class="params">(RootBeanDefinition beanDefinition, Class&lt;?&gt; beanType, String beanName)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">resetBeanDefinition</span><span class="params">(String beanName)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>InstantiationAwareBeanPostProcessor<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">InstantiationAwareBeanPostProcessor</span> <span class="keyword">extends</span> <span class="title">BeanPostProcessor</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">default</span> Object <span class="title">postProcessBeforeInstantiation</span><span class="params">(Class&lt;?&gt; beanClass, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="function"><span class="keyword">default</span> <span class="keyword">boolean</span> <span class="title">postProcessAfterInstantiation</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="function"><span class="keyword">default</span> PropertyValues <span class="title">postProcessProperties</span><span class="params">(PropertyValues pvs, Object bean, String beanName)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>Instantiation表示实例化,即ioc反射创建BeanWrap;Initialization表示初始化,指ioc对于bean的init逻辑,如init-method</li>
<li>SmartInstantiationAwareBeanPostProcessor#getEarlyBeanReference发生在早期引用获取过程</li>
<li>具体执行顺序参考<a href="/2019/05/21/ioc/#关于单例bean的生命周期和循环依赖问题">生命周期</a><h3 id="LTW"><a href="#LTW" class="headerlink" title="LTW"></a>LTW</h3>载入时织入,使用方式参考<a href="https://www.w3xue.com/exp/article/20189/1890.html" target="_blank" rel="noopener">LTW</a>,</li>
<li>由<code>LoadTimeWeaverBeanDefinitionParser</code>创建<code>AspectJWeavingEnabler</code>以及<code>DefaultContextLoadTimeWeaver</code><h3 id="MessageSource"><a href="#MessageSource" class="headerlink" title="MessageSource"></a>MessageSource</h3>该接口是spring提供的和i18n相关的基础类,使用起来并不复杂</li>
<li><p>ResourceBulde:jdk实现的国际化类,也是messageSource的内部原理</p>
<ul>
<li>准备多种语言properties文件<img src="/2020/02/11/spring%E5%B8%B8%E8%A7%81/%E5%A4%9A%E8%AF%AD%E8%A8%80.png" class="">
error.properties<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0000=error</span><br><span class="line">0001=info</span><br></pre></td></tr></table></figure>
error_zh.Properties<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0000=错误</span><br><span class="line">test=this is a &#123;0&#125;</span><br></pre></td></tr></table></figure></li>
<li>使用<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据Local获取不同的ResourceBulde</span></span><br><span class="line">ResourceBundle resourceBundle = ResourceBundle.getBundle(<span class="string">"error"</span>,Locale.getDefault());</span><br><span class="line">String zh_test = resourceBundle.getString(<span class="string">"test"</span>)</span><br><span class="line"><span class="comment">//this is a &#123;0&#125;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>MessageFormat:jdk提供用来替换占位符的工具类</p>
<ul>
<li>接上文<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MessageFormat messageFormat = <span class="keyword">new</span> MessageFormat(zh_test);</span><br><span class="line">messageFormat.format(<span class="keyword">new</span> String[]&#123;<span class="string">"测试"</span>&#125;)</span><br><span class="line"><span class="comment">//静态调用</span></span><br><span class="line">MessageFormat.format(<span class="string">"this is a &#123;0&#125;"</span>,<span class="string">"测试"</span>)</span><br><span class="line"><span class="comment">//结果都是 this is a 测试</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>MessageSource<ul>
<li>定义<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* code 表示要转换的key,如上文的0000,test</span></span><br><span class="line"><span class="comment">* args 表示可以替换的占位符,如MessageFormat.format("this is a &#123;0&#125;",new String[]&#123;"测试"&#125;)第二个参数</span></span><br><span class="line"><span class="comment">* defaultMessage 表示未能匹配时返回的默认值</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function">String <span class="title">getMessage</span><span class="params">(String code, @Nullable Object[] args, @Nullable String defaultMessage, Locale locale)</span></span>;</span><br><span class="line"><span class="comment">//无默认,不匹配则抛出异常</span></span><br><span class="line"><span class="function">String <span class="title">getMessage</span><span class="params">(String code, @Nullable Object[] args, Locale locale)</span> <span class="keyword">throws</span> NoSuchMessageException</span>;</span><br><span class="line"><span class="comment">//MessageSourceResolvable仅仅是封装了第一个函数的前三个参数</span></span><br><span class="line"><span class="function">String <span class="title">getMessage</span><span class="params">(MessageSourceResolvable resolvable, Locale locale)</span> <span class="keyword">throws</span> NoSuchMessageException</span>;</span><br></pre></td></tr></table></figure></li>
<li>使用<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ResourceBundleMessageSource是spring提供的实现之一</span></span><br><span class="line">ResourceBundleMessageSource messageSource = <span class="keyword">new</span> ResourceBundleMessageSource();</span><br><span class="line"><span class="comment">//设置properties</span></span><br><span class="line">messageSource.setBasename(<span class="string">"error"</span>);</span><br><span class="line">messageSource.setDefaultEncoding(<span class="string">"UTF-8"</span>);</span><br><span class="line">String message = messageSource.getMessage(<span class="string">"0001"</span>, <span class="keyword">null</span>, Locale.ENGLISH);</span><br><span class="line">System.out.println(message);</span><br><span class="line"><span class="comment">//error</span></span><br><span class="line">String str1 = messageSource.getMessage(<span class="string">"test"</span>,<span class="keyword">new</span> String[]&#123;<span class="string">"测试"</span>&#125;,Locale.CHINESE);</span><br><span class="line">System.out.println(str1);</span><br><span class="line"><span class="comment">//this is a 测试</span></span><br></pre></td></tr></table></figure>
<h3 id="spring框架中提供的特殊调用点"><a href="#spring框架中提供的特殊调用点" class="headerlink" title="spring框架中提供的特殊调用点"></a>spring框架中提供的特殊调用点</h3><h4 id="spring-web关于web容器的初始化"><a href="#spring-web关于web容器的初始化" class="headerlink" title="spring web关于web容器的初始化"></a>spring web关于web容器的初始化</h4></li>
</ul>
</li>
<li>web相关:参考<a href="/2019/02/19/SpringMVC源码/#dispatcherServlet">dispatcherServlet</a><ul>
<li>ContextLoaderListener:初始化MVC中ioc容器</li>
<li>SpringServletContainerInitializer:ServletContainerInitializer框架</li>
<li>WebApplicationInitializer:web初始化实际调用接口</li>
</ul>
</li>
<li>MVC相关<ul>
<li>WebMvcConfigurer:MVC内部的设置</li>
</ul>
</li>
<li>spring context<ul>
<li>ApplicationContextInitializer:该接口被context#refresh的调用|或context创建者调用<br>,就是整体项目的入口,如SpringApplication | FrameworkServlet<br>,就是整体项目的入口,如SpringApplication | FrameworkServlet<h3 id="springIo"><a href="#springIo" class="headerlink" title="springIo"></a>springIo</h3><h4 id="resource接口"><a href="#resource接口" class="headerlink" title="resource接口"></a>resource接口</h4><img src="/2020/02/11/spring%E5%B8%B8%E8%A7%81/resource.png" class="">
<figure class="highlight java"><figcaption><span>Resource</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Resource</span> <span class="keyword">extends</span> <span class="title">InputStreamSource</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">boolean</span> <span class="title">exists</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">default</span> <span class="keyword">boolean</span> <span class="title">isReadable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> exists();</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="function"><span class="keyword">default</span> <span class="keyword">boolean</span> <span class="title">isOpen</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="function"><span class="keyword">default</span> <span class="keyword">boolean</span> <span class="title">isFile</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="function">URL <span class="title">getURL</span><span class="params">()</span> <span class="keyword">throws</span> IOException</span>;</span><br><span class="line">  <span class="function">URI <span class="title">getURI</span><span class="params">()</span> <span class="keyword">throws</span> IOException</span>;</span><br><span class="line">  <span class="function">File <span class="title">getFile</span><span class="params">()</span> <span class="keyword">throws</span> IOException</span>;</span><br><span class="line">  <span class="function"><span class="keyword">default</span> ReadableByteChannel <span class="title">readableChannel</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Channels.newChannel(getInputStream());</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="function"><span class="keyword">long</span> <span class="title">contentLength</span><span class="params">()</span> <span class="keyword">throws</span> IOException</span>;</span><br><span class="line">  <span class="function"><span class="keyword">long</span> <span class="title">lastModified</span><span class="params">()</span> <span class="keyword">throws</span> IOException</span>;</span><br><span class="line">  <span class="function">Resource <span class="title">createRelative</span><span class="params">(String relativePath)</span> <span class="keyword">throws</span> IOException</span>;</span><br><span class="line">  <span class="function">String <span class="title">getFilename</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="function">String <span class="title">getDescription</span><span class="params">()</span></span>;</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<h5 id="ResolvingResource"><a href="#ResolvingResource" class="headerlink" title="ResolvingResource"></a>ResolvingResource</h5>这种资源表示从url中获取,支持http协议,file,jboss的vfs协议<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">exists</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            URL url = getURL();</span><br><span class="line">            <span class="keyword">if</span> (ResourceUtils.isFileURL(url)) &#123; <span class="comment">//file: vfs协议</span></span><br><span class="line">                <span class="comment">// Proceed with file system resolution</span></span><br><span class="line">                <span class="keyword">return</span> getFile().exists();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123; <span class="comment">//http协议</span></span><br><span class="line">                <span class="comment">// Try a URL connection content-length header</span></span><br><span class="line">                URLConnection con = url.openConnection();</span><br><span class="line">                customizeConnection(con);</span><br><span class="line">                HttpURLConnection httpCon =</span><br><span class="line">                        (con <span class="keyword">instanceof</span> HttpURLConnection ? (HttpURLConnection) con : <span class="keyword">null</span>);</span><br><span class="line">                <span class="keyword">if</span> (httpCon != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">int</span> code = httpCon.getResponseCode();</span><br><span class="line">                    <span class="keyword">if</span> (code == HttpURLConnection.HTTP_OK) &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (code == HttpURLConnection.HTTP_NOT_FOUND) &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (con.getContentLength() &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (httpCon != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// No HTTP OK status, and no content-length header: give up</span></span><br><span class="line">                    httpCon.disconnect();</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// Fall back to stream existence: can we open the stream?</span></span><br><span class="line">                    getInputStream().close();</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>ClassPathResource<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> InputStream <span class="title">getInputStream</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        InputStream is;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.clazz != <span class="keyword">null</span>) &#123;</span><br><span class="line">            is = <span class="keyword">this</span>.clazz.getResourceAsStream(<span class="keyword">this</span>.path);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.classLoader != <span class="keyword">null</span>) &#123;</span><br><span class="line">            is = <span class="keyword">this</span>.classLoader.getResourceAsStream(<span class="keyword">this</span>.path);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            is = ClassLoader.getSystemResourceAsStream(<span class="keyword">this</span>.path);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (is == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> FileNotFoundException(getDescription() + <span class="string">" cannot be opened because it does not exist"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> is;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
<li>PathResource和FileSystemResource实现,都是依托了nio实现<h5 id="HttpResource"><a href="#HttpResource" class="headerlink" title="HttpResource"></a>HttpResource</h5>这里Resource使用在<code>ResourceHttpRequestHandler</code>类中处理web请求静态资源的时候用来附件响应头<h5 id="ContextResouce"><a href="#ContextResouce" class="headerlink" title="ContextResouce"></a>ContextResouce</h5>表示从封闭的<code>context</code>中获取资源,典型的就是<code>ServletContext</code><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ContextResource</span> <span class="keyword">extends</span> <span class="title">Resource</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Return the path within the enclosing 'context'.</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;This is typically path relative to a context-specific root directory,</span></span><br><span class="line"><span class="comment">     * e.g. a ServletContext root or a PortletContext root.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">String <span class="title">getPathWithinContext</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="ServletCOntextResouce"><a href="#ServletCOntextResouce" class="headerlink" title="ServletCOntextResouce"></a>ServletCOntextResouce</h6>直接从<code>ServletContext</code>中获取资源<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> InputStream <span class="title">getInputStream</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        InputStream is = <span class="keyword">this</span>.servletContext.getResourceAsStream(<span class="keyword">this</span>.path);</span><br><span class="line">        <span class="keyword">if</span> (is == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> FileNotFoundException(<span class="string">"Could not open "</span> + getDescription());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> is;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="ResouceLoader"><a href="#ResouceLoader" class="headerlink" title="ResouceLoader"></a>ResouceLoader</h4>用来加载Resource资源的support<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Resource <span class="title">getResource</span><span class="params">(String location)</span></span>;</span><br><span class="line"><span class="function">ClassLoader <span class="title">getClassLoader</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure></li>
<li>支持全路径:<code>file:C:/test.dat</code></li>
<li>支持类路径:<code>classpath:test.dat</code></li>
<li>支持相对路径:<code>WEB-INF/test.dat</code><img src="/2020/02/11/spring%E5%B8%B8%E8%A7%81/resourceLoader.png" class="">
实现中把context排除,那是包装类实现</li>
</ul>
<h5 id="DefaultResourceLoader"><a href="#DefaultResourceLoader" class="headerlink" title="DefaultResourceLoader"></a>DefaultResourceLoader</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Resource <span class="title">getResource</span><span class="params">(String location)</span> </span>&#123;</span><br><span class="line">        Assert.notNull(location, <span class="string">"Location must not be null"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (ProtocolResolver protocolResolver : <span class="keyword">this</span>.protocolResolvers) &#123; <span class="comment">//这是一个spi实现,spring默认没有实现</span></span><br><span class="line">            Resource resource = protocolResolver.resolve(location, <span class="keyword">this</span>);</span><br><span class="line">            <span class="keyword">if</span> (resource != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> resource;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//[1]ClassPathResource</span></span><br><span class="line">        <span class="keyword">if</span> (location.startsWith(<span class="string">"/"</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> getResourceByPath(location); <span class="comment">//这个函数交由子类实现</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (location.startsWith(CLASSPATH_URL_PREFIX)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ClassPathResource(location.substring(CLASSPATH_URL_PREFIX.length()), getClassLoader());</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="comment">//[1!]</span></span><br><span class="line">    <span class="comment">//[2]UrlResource</span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// Try to parse the location as a URL...</span></span><br><span class="line">                URL url = <span class="keyword">new</span> URL(location);</span><br><span class="line">                <span class="keyword">return</span> (ResourceUtils.isFileURL(url) ? <span class="keyword">new</span> FileUrlResource(url) : <span class="keyword">new</span> UrlResource(url));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (MalformedURLException ex) &#123;</span><br><span class="line">                <span class="comment">// No URL -&gt; resolve as resource path.</span></span><br><span class="line">                <span class="keyword">return</span> getResourceByPath(location);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="comment">//[2!]</span></span><br><span class="line">    &#125;</span><br><span class="line">  <span class="comment">//当资源以/开头时就会调用子类实现</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> Resource <span class="title">getResourceByPath</span><span class="params">(String path)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ClassPathContextResource(path, getClassLoader());</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ClassPathContextResource</span> <span class="keyword">extends</span> <span class="title">ClassPathResource</span> <span class="keyword">implements</span> <span class="title">ContextResource</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ClassPathContextResource</span><span class="params">(String path, @Nullable ClassLoader classLoader)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>(path, classLoader);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getPathWithinContext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> getPath();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Resource <span class="title">createRelative</span><span class="params">(String relativePath)</span> </span>&#123;</span><br><span class="line">            String pathToUse = StringUtils.applyRelativePath(getPath(), relativePath);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ClassPathContextResource(pathToUse, getClassLoader());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>总结<ul>
<li>若使用url则返回<code>UrlResource</code></li>
<li>若使用”classpath:”则返回<code>ClassPathResource</code></li>
<li>若使用”/“开头则调用<code>getResourceByPath</code>,由具体实现决定</li>
<li>该体系内部都是实现了一个<code>ContextResouce</code>的<code>Resource</code><h6 id="ClassRelativeResourceLoader"><a href="#ClassRelativeResourceLoader" class="headerlink" title="ClassRelativeResourceLoader"></a>ClassRelativeResourceLoader</h6></li>
</ul>
</li>
<li>代码逻辑<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Class&lt;?&gt; clazz;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Create a new ClassRelativeResourceLoader for the given class.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> clazz the class to load resources through</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ClassRelativeResourceLoader</span><span class="params">(Class&lt;?&gt; clazz)</span> </span>&#123;</span><br><span class="line">        Assert.notNull(clazz, <span class="string">"Class must not be null"</span>);</span><br><span class="line">        <span class="keyword">this</span>.clazz = clazz;</span><br><span class="line">        setClassLoader(clazz.getClassLoader());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Resource <span class="title">getResourceByPath</span><span class="params">(String path)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ClassRelativeContextResource(path, <span class="keyword">this</span>.clazz); <span class="comment">//实际返回一个内部类</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ClassPathResource that explicitly expresses a context-relative path</span></span><br><span class="line"><span class="comment">     * through implementing the ContextResource interface.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ClassRelativeContextResource</span> <span class="keyword">extends</span> <span class="title">ClassPathResource</span> <span class="keyword">implements</span> <span class="title">ContextResource</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Class&lt;?&gt; clazz;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ClassRelativeContextResource</span><span class="params">(String path, Class&lt;?&gt; clazz)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>(path, clazz);</span><br><span class="line">            <span class="keyword">this</span>.clazz = clazz;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getPathWithinContext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> getPath();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Resource <span class="title">createRelative</span><span class="params">(String relativePath)</span> </span>&#123;</span><br><span class="line">            String pathToUse = StringUtils.applyRelativePath(getPath(), relativePath);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ClassRelativeContextResource(pathToUse, <span class="keyword">this</span>.clazz);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
<li>总结:开头为”/“返回classpath下文件<h6 id="FileSystemResourceLoader"><a href="#FileSystemResourceLoader" class="headerlink" title="FileSystemResourceLoader"></a>FileSystemResourceLoader</h6></li>
<li>代码逻辑<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileSystemResourceLoader</span> <span class="keyword">extends</span> <span class="title">DefaultResourceLoader</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Resource <span class="title">getResourceByPath</span><span class="params">(String path)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (path.startsWith(<span class="string">"/"</span>)) &#123;</span><br><span class="line">            path = path.substring(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> FileSystemContextResource(path);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">FileSystemContextResource</span> <span class="keyword">extends</span> <span class="title">FileSystemResource</span> <span class="keyword">implements</span> <span class="title">ContextResource</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">FileSystemContextResource</span><span class="params">(String path)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>(path);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getPathWithinContext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> getPath();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>总结:开头为”/“返回文件系统<h5 id="ResourcePatternResolver"><a href="#ResourcePatternResolver" class="headerlink" title="ResourcePatternResolver"></a>ResourcePatternResolver</h5>支持ant风格进行获取资源<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ResourcePatternResolver</span> <span class="keyword">extends</span> <span class="title">ResourceLoader</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Pseudo URL prefix for all matching resources from the class path: "classpath*:"</span></span><br><span class="line"><span class="comment">     * This differs from ResourceLoader's classpath URL prefix in that it</span></span><br><span class="line"><span class="comment">     * retrieves all matching resources for a given name (e.g. "/beans.xml"),</span></span><br><span class="line"><span class="comment">     * for example in the root of all deployed JAR files.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> org.springframework.core.io.ResourceLoader#CLASSPATH_URL_PREFIX</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String CLASSPATH_ALL_URL_PREFIX = <span class="string">"classpath*:"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Resolve the given location pattern into Resource objects.</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;Overlapping resource entries that point to the same physical</span></span><br><span class="line"><span class="comment">     * resource should be avoided, as far as possible. The result should</span></span><br><span class="line"><span class="comment">     * have set semantics.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> locationPattern the location pattern to resolve</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the corresponding Resource objects</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException in case of I/O errors</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Resource[] getResources(String locationPattern) <span class="keyword">throws</span> IOException;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="PathMatchingResourcePatternResolver"><a href="#PathMatchingResourcePatternResolver" class="headerlink" title="PathMatchingResourcePatternResolver"></a>PathMatchingResourcePatternResolver</h6></li>
<li>概述<ul>
<li>支持 占位符,即:’classpath:’,或者ant风格,’<em>‘,`*</em><code>,</code>?`</li>
<li>支持协议”file”,”jar”</li>
<li>“classpath*:”,表示从所有类路径下寻找</li>
</ul>
</li>
<li>代码逻辑  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PathMatchingResourcePatternResolver</span> <span class="keyword">implements</span> <span class="title">ResourcePatternResolver</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">PathMatchingResourcePatternResolver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.resourceLoader = <span class="keyword">new</span> DefaultResourceLoader();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Create a new PathMatchingResourcePatternResolver.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;ClassLoader access will happen via the thread context class loader.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> resourceLoader the ResourceLoader to load root directories and</span></span><br><span class="line"><span class="comment"> * actual resources with</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">PathMatchingResourcePatternResolver</span><span class="params">(ResourceLoader resourceLoader)</span> </span>&#123;</span><br><span class="line">  Assert.notNull(resourceLoader, <span class="string">"ResourceLoader must not be null"</span>);</span><br><span class="line">  <span class="keyword">this</span>.resourceLoader = resourceLoader;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Create a new PathMatchingResourcePatternResolver with a DefaultResourceLoader.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> classLoader the ClassLoader to load classpath resources with,</span></span><br><span class="line"><span class="comment"> * or &#123;<span class="doctag">@code</span> null&#125; for using the thread context class loader</span></span><br><span class="line"><span class="comment"> * at the time of actual resource access</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> org.springframework.core.io.DefaultResourceLoader</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">PathMatchingResourcePatternResolver</span><span class="params">(@Nullable ClassLoader classLoader)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.resourceLoader = <span class="keyword">new</span> DefaultResourceLoader(classLoader);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//包装类实现</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Resource <span class="title">getResource</span><span class="params">(String location)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> getResourceLoader().getResource(location);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//path匹配实现</span></span><br><span class="line"><span class="keyword">public</span> Resource[] getResources(String locationPattern) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        Assert.notNull(locationPattern, <span class="string">"Location pattern must not be null"</span>);</span><br><span class="line">        <span class="keyword">if</span> (locationPattern.startsWith(CLASSPATH_ALL_URL_PREFIX)) &#123; <span class="comment">//匹配classpath*:,即搜索全类路径</span></span><br><span class="line">            <span class="comment">// a class path resource (multiple resources for same name possible)</span></span><br><span class="line">            <span class="keyword">if</span> (getPathMatcher().isPattern(locationPattern.substring(CLASSPATH_ALL_URL_PREFIX.length()))) &#123; <span class="comment">//并非是ant路径即,后边路径中不包含*和?</span></span><br><span class="line">                <span class="comment">// a class path resource pattern</span></span><br><span class="line">                <span class="keyword">return</span> findPathMatchingResources(locationPattern);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// all class path resources with the given name</span></span><br><span class="line">                <span class="keyword">return</span> findAllClassPathResources(locationPattern.substring(CLASSPATH_ALL_URL_PREFIX.length()));<span class="comment">//[2]</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Generally only look for a pattern after a prefix here,</span></span><br><span class="line">            <span class="comment">// and on Tomcat only after the "*/" separator for its "war:" protocol.</span></span><br><span class="line">      <span class="comment">//若无前缀则prefixEnd=0</span></span><br><span class="line">            <span class="keyword">int</span> prefixEnd = (locationPattern.startsWith(<span class="string">"war:"</span>) ? locationPattern.indexOf(<span class="string">"*/"</span>) + <span class="number">1</span> :</span><br><span class="line">                    locationPattern.indexOf(<span class="string">':'</span>) + <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span> (getPathMatcher().isPattern(locationPattern.substring(prefixEnd))) &#123; <span class="comment">//不带classpath*,带ant,带协议头[3]</span></span><br><span class="line">                <span class="comment">// a file pattern</span></span><br><span class="line">                <span class="keyword">return</span> findPathMatchingResources(locationPattern);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123; <span class="comment">//最简单的类型,如com/light/test.class,会通过当前类加载进行加载</span></span><br><span class="line">                <span class="comment">// a single resource with the given name</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Resource[] &#123;getResourceLoader().getResource(locationPattern)&#125;;<span class="comment">//不带classpath*,不带ant,带协议头[4]</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>总结<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">antResource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    PathMatchingResourcePatternResolver resolver = <span class="keyword">new</span> PathMatchingResourcePatternResolver();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//[4]</span></span><br><span class="line">        printAllName(resolver.getResources(<span class="string">"aop1.xml"</span>));</span><br><span class="line">        printAllName(resolver.getResources(<span class="string">"classpath:aop1.xml"</span>));</span><br><span class="line">        printAllName(resolver.getResources(<span class="string">"file:aop1.xml"</span>));</span><br><span class="line">        printAllName(resolver.getResources(<span class="string">"java/lang/String.class"</span>));</span><br><span class="line">        printAllName(resolver.getResources(<span class="string">"com/google/protobuf/AbstractMessage.class"</span>));</span><br><span class="line">        <span class="comment">//[3]</span></span><br><span class="line"><span class="comment">//            printAllName(resolver.getResources("com/google/protobuf/*.class"));</span></span><br><span class="line">        <span class="comment">//[2]</span></span><br><span class="line"><span class="comment">//            printAllName(resolver.getResources("classpath*:com/**"));</span></span><br><span class="line">        <span class="comment">//[1]</span></span><br><span class="line">        printAllName(resolver.getResources(<span class="string">"classpath*:com/jcf/Test1.class"</span>));</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">printAllName</span><span class="params">(Resource... resources)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (Resource resource : resources) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(resource.getURL().toString());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(<span class="string">"====================================="</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
输出如下<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">file:&#x2F;F:&#x2F;java&#x2F;example&#x2F;app&#x2F;springTest&#x2F;target&#x2F;test-classes&#x2F;aop1.xml</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">file:&#x2F;F:&#x2F;java&#x2F;example&#x2F;app&#x2F;springTest&#x2F;target&#x2F;test-classes&#x2F;aop1.xml</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">file:aop1.xml</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">jrt:&#x2F;java.base&#x2F;java&#x2F;lang&#x2F;String.class</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">jar:file:&#x2F;C:&#x2F;Users&#x2F;fancylight&#x2F;.m2&#x2F;repository&#x2F;com&#x2F;google&#x2F;protobuf&#x2F;protobuf-java&#x2F;2.6.0&#x2F;protobuf-java-2.6.0.jar!&#x2F;com&#x2F;google&#x2F;protobuf&#x2F;AbstractMessage.class</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">file:&#x2F;F:&#x2F;java&#x2F;example&#x2F;app&#x2F;jcf&#x2F;target&#x2F;classes&#x2F;com&#x2F;jcf&#x2F;Test1.class</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure></li>
<li>实际上<code>xx:</code>,这部分可以是协议</li>
<li>如果实际是从类路径中获取数据,那么ide中运行,可能会出现<code>file</code>(target文件夹),’jar’(maven仓库),<code>jrt</code>(jdk包)</li>
</ul>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">fancylight</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://www.fancylight.top/2020/02/11/spring%E5%B8%B8%E8%A7%81/">https://www.fancylight.top/2020/02/11/spring%E5%B8%B8%E8%A7%81/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://www.fancylight.top" target="_blank">博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%A1%86%E6%9E%B6/">框架    </a><a class="post-meta__tags" href="/tags/spring/">spring    </a><a class="post-meta__tags" href="/tags/spring%E7%BB%84%E4%BB%B6/">spring组件    </a></div><div class="post_share"><div class="social-share" data-image="/img/java.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/wechat.jpg" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/alipay.jpg" alt="支付寶"/><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/03/04/Spring-aop%E7%BB%87%E5%85%A5%E5%88%86%E6%9E%90/"><img class="prev_cover" src="/img/spring.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Spring_aop织入分析</div></div></a></div><div class="next-post pull_right"><a href="/2019/12/26/springMVC%E6%A0%B8%E5%BF%83/"><img class="next_cover" src="/img/spring.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">springMVC核心</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/03/10/spring内省/" title="spring内省"><img class="relatedPosts_cover "src="/img/spring.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-03-10</div><div class="relatedPosts_title">spring内省</div></div></a></div><div class="relatedPosts_item"><a href="/2020/03/04/Spring-aop织入分析/" title="Spring_aop织入分析"><img class="relatedPosts_cover "src="/img/spring.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-03-04</div><div class="relatedPosts_title">Spring_aop织入分析</div></div></a></div><div class="relatedPosts_item"><a href="/2019/02/19/SpringMVC源码/" title="SpringMVC体系"><img class="relatedPosts_cover "src="/img/spring.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-02-19</div><div class="relatedPosts_title">SpringMVC体系</div></div></a></div><div class="relatedPosts_item"><a href="/2019/05/25/aop/" title="aop"><img class="relatedPosts_cover "src="/img/spring.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-05-25</div><div class="relatedPosts_title">aop</div></div></a></div><div class="relatedPosts_item"><a href="/2020/04/01/spring-cache/" title="spring-cache"><img class="relatedPosts_cover "src="/img/spring.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-04-01</div><div class="relatedPosts_title">spring-cache</div></div></a></div><div class="relatedPosts_item"><a href="/2019/09/05/springBoot学习一/" title="springBoot学习一"><img class="relatedPosts_cover "src="/img/spring.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-09-05</div><div class="relatedPosts_title">springBoot学习一</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: '624d139155758ea48077',
  clientSecret: 'cc126a301586ea63779cec6a6b53101749dbc9dd',
  repo: 'gittalk_issue',
  owner: 'fancylight',
  admin: ['fancylight'],
  id: md5(decodeURI(location.pathname)),
  language: 'zh-CN',
  perPage: 10,
  distractionFreeMode: false,
  pagerDirection: 'last',
  createIssueManually: false,
  updateCountCallback: commentCount
})
gitalk.render('gitalk-container')

function commentCount(n){
  try {
    document.getElementsByClassName('gitalk-comment-count')[0].innerHTML= n
  } catch (e) {
    return false
  }
}</script></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By fancylight</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  CommonHTML: {
    linebreaks: { automatic: true, width: "90% container" }
  },
  "HTML-CSS": { 
    linebreaks: { automatic: true, width: "90% container" }
  },
  "SVG": { 
    linebreaks: { automatic: true, width: "90% container" }
  }
});
</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for (i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script><script src="https://cdn.jsdelivr.net/npm/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="/js/search/local-search.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end --></body></html>